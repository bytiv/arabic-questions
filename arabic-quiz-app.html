<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>كويز الإعراب المتقدم</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom right, #f3e7ff, #dbeafe);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .container {
            max-width: 48rem;
            width: 100%;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            padding: 2rem;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
        }

        .score-info {
            text-align: right;
        }

        .score-info .question-number {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .score-info .score {
            font-weight: bold;
            color: #9333ea;
        }

        .question-container {
            background: #f9fafb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .category {
            text-align: right;
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .question {
            text-align: right;
            font-size: 1.125rem;
            line-height: 1.75;
            margin-bottom: 1rem;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .option-btn {
            width: 100%;
            padding: 1.25rem;
            text-align: right;
            border-radius: 0.75rem;
            border: 2px solid #d1d5db;
            background: white;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .option-btn:not(:disabled):hover {
            border-color: #a855f7;
            background: #faf5ff;
        }

        .option-btn:disabled {
            cursor: not-allowed;
        }

        .option-btn.correct {
            border-color: #10b981;
            background: #f0fdf4;
            color: #065f46;
        }

        .option-btn.incorrect {
            border-color: #ef4444;
            background: #fef2f2;
            color: #991b1b;
        }

        .option-btn.neutral {
            border-color: #d1d5db;
            background: #f9fafb;
            color: #6b7280;
        }

        .icon {
            width: 26px;
            height: 26px;
            flex-shrink: 0;
        }

        .explanation-box {
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            border: 2px solid;
        }

        .explanation-box.correct {
            background: #f0fdf4;
            border-color: #86efac;
        }

        .explanation-box.incorrect {
            background: #fef2f2;
            border-color: #fca5a5;
        }

        .explanation-title {
            text-align: right;
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .explanation-content {
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .explanation-text {
            text-align: right;
            color: #1f2937;
            line-height: 1.75;
            font-size: 1.125rem;
        }

        .explanation-text strong {
            color: #7c3aed;
        }

        .topic-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1d4ed8;
            text-align: right;
            font-weight: 600;
        }

        .next-btn {
            width: 100%;
            background: linear-gradient(to right, #9333ea, #3b82f6);
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            font-weight: bold;
            font-size: 1.25rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .next-btn:hover {
            background: linear-gradient(to right, #7c3aed, #2563eb);
        }

        .current-score {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
            color: #6b7280;
            font-size: 1.125rem;
        }

        .current-score .score-value {
            font-weight: bold;
            color: #9333ea;
            font-size: 1.25rem;
        }

        .restart-btn {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .restart-btn:hover {
            background: #f9fafb;
        }

        /* Results Page Styles */
        .results-container {
            text-align: center;
        }

        .trophy-icon {
            width: 6rem;
            height: 6rem;
            margin: 0 auto 1.5rem;
            color: #eab308;
        }

        .results-title {
            font-size: 2.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .final-score {
            font-size: 4.5rem;
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 0.75rem;
        }

        .percentage {
            font-size: 1.875rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .results-message {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .category-stats {
            background: #f9fafb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .stats-title {
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-item {
            padding: 1rem;
            background: white;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            margin-bottom: 0.75rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-category {
            text-align: right;
            font-weight: 600;
        }

        .stat-score {
            text-align: left;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .btn-primary {
            flex: 1;
            background: linear-gradient(to right, #9333ea, #3b82f6);
            color: white;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: linear-gradient(to right, #7c3aed, #2563eb);
        }

        .btn-secondary {
            flex: 1;
            border: 2px solid #d1d5db;
            background: white;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: #f9fafb;
        }

        .final-stats {
            margin-top: 1.5rem;
            text-align: center;
            border-top: 1px solid #e5e7eb;
            padding-top: 1rem;
            color: #6b7280;
            font-size: 1.125rem;
        }

        .final-stats .final-score-value {
            font-weight: bold;
            color: #9333ea;
            font-size: 1.25rem;
        }
    </style>
</head>
<body>
    <div class="container" id="app"></div>

    <script>
        // ========================================
        // PASTE YOUR QUESTIONS ARRAY HERE
        // ========================================
  const questions = [
    // علامات الاسم وأنواعه
    {
      id: 1,
      category: "علامات الاسم وأنواعه",
      question: "أعرب كلمة 'المهندسون' في الجملة: 'حضر المهندسون إلى المؤتمر'",
      options: [
        "فاعل مرفوع وعلامة رفعه الضمة الظاهرة",
        "فاعل مرفوع وعلامة رفعه الواو لأنه جمع مذكر سالم",
        "مبتدأ مرفوع وعلامة رفعه الواو",
        "اسم مجرور وعلامة جره الياء"
      ],
      correctAnswer: 1,
      explanation: "المهندسون فاعل مرفوع وعلامة رفعه الواو (وليس الضمة) لأنه جمع مذكر سالم. جمع المذكر السالم يُرفع بالواو ويُنصب ويُجر بالياء.",
      topic: "أنواع الأسماء - جمع المذكر السالم وعلاماته الإعرابية"
    },
    {
      id: 2,
      category: "علامات الاسم وأنواعه",
      question: "ما نوع الجمع في كلمة 'أقلام'؟",
      options: [
        "جمع مذكر سالم",
        "جمع مؤنث سالم",
        "جمع تكسير",
        "ملحق بجمع المذكر السالم"
      ],
      correctAnswer: 2,
      explanation: "أقلام جمع تكسير لأنه تغيرت صيغة المفرد (قلم) عند الجمع. جمع التكسير لا ينتهي بـ (ون/ين) أو (ات) وتتغير فيه بنية الكلمة الأصلية.",
      topic: "أنواع الجموع - الفرق بين الجمع السالم وجمع التكسير"
    },
    {
      id: 3,
      category: "علامات الاسم وأنواعه",
      question: "أعرب 'الطالبين' في: 'كرّمت المدرسة الطالبين المتفوقين'",
      options: [
        "فاعل مرفوع وعلامة رفعه الياء",
        "مفعول به منصوب وعلامة نصبه الياء لأنه مثنى",
        "مفعول به منصوب وعلامة نصبه الفتحة",
        "مبتدأ مرفوع وعلامة رفعه الألف"
      ],
      correctAnswer: 1,
      explanation: "الطالبين مفعول به منصوب وعلامة نصبه الياء (وليس الفتحة) لأنه مثنى. المثنى يُرفع بالألف ويُنصب ويُجر بالياء.",
      topic: "إعراب المثنى - علامات إعراب المثنى"
    },
    {
      id: 4,
      category: "علامات الاسم وأنواعه",
      question: "في الجملة: 'رأيت المعلمات الفاضلات'، ما علامة نصب 'المعلمات'؟",
      options: [
        "الفتحة الظاهرة",
        "الكسرة نيابة عن الفتحة",
        "الياء لأنه جمع مؤنث سالم",
        "الألف لأنه مثنى"
      ],
      correctAnswer: 1,
      explanation: "المعلمات مفعول به منصوب وعلامة نصبه الكسرة (وليس الفتحة) نيابة عن الفتحة لأنه جمع مؤنث سالم. جمع المؤنث السالم يُرفع بالضمة ويُنصب ويُجر بالكسرة.",
      topic: "إعراب جمع المؤنث السالم - علامات إعرابه الخاصة"
    },

    // الأسماء المعربة والمبنية
    {
      id: 5,
      category: "الأسماء المعربة والمبنية",
      question: "أعرب 'هذان' في الجملة: 'هذان طالبان مجتهدان'",
      options: [
        "اسم إشارة مبني في محل رفع مبتدأ",
        "مبتدأ مرفوع وعلامة رفعه الألف",
        "اسم إشارة معرب مرفوع بالألف",
        "ضمير منفصل مبني في محل رفع مبتدأ"
      ],
      correctAnswer: 2,
      explanation: "هذان اسم إشارة معرب (وليس مبني) مرفوع بالألف لأنه مثنى. معظم أسماء الإشارة مبنية ما عدا (هذان/هاتان) في حالة الرفع و(هذين/هاتين) في حالة النصب والجر.",
      topic: "الأسماء المبنية والمعربة - الاستثناءات في أسماء الإشارة"
    },
    {
      id: 6,
      category: "الأسماء المعربة والمبنية",
      question: "ما إعراب 'الذين' في: 'كافأت الذين اجتهدوا'؟",
      options: [
        "اسم موصول مبني على الفتح في محل نصب مفعول به",
        "اسم موصول معرب منصوب بالياء",
        "ضمير متصل مبني في محل نصب",
        "اسم موصول مبني على السكون في محل نصب"
      ],
      correctAnswer: 0,
      explanation: "الذين اسم موصول مبني على الفتح (وليس معرب) في محل نصب مفعول به. جميع الأسماء الموصولة مبنية، وتُعرب حسب موقعها في الجملة بالمحل.",
      topic: "الأسماء الموصولة - إعرابها بالمحل"
    },
    {
      id: 7,
      category: "الأسماء المعربة والمبنية",
      question: "أعرب 'نحن' في: 'نحن المسلمون إخوة'",
      options: [
        "مبتدأ مرفوع وعلامة رفعه الضمة",
        "ضمير منفصل معرب في محل رفع مبتدأ",
        "ضمير منفصل مبني على الضم في محل رفع مبتدأ",
        "اسم مبني على الفتح في محل رفع مبتدأ"
      ],
      correctAnswer: 2,
      explanation: "نحن ضمير منفصل مبني على الضم (وليس معرب) في محل رفع مبتدأ. جميع الضمائر مبنية، وتُعرب حسب موقعها بالمحل.",
      topic: "الضمائر - الضمائر المنفصلة وإعرابها"
    },

    // الجملة الاسمية
    {
      id: 8,
      category: "الجملة الاسمية",
      question: "أعرب الجملة: 'الصدقُ منجاةٌ' كاملة",
      options: [
        "الصدقُ: مبتدأ مرفوع، منجاةٌ: فاعل مرفوع",
        "الصدقُ: مبتدأ مرفوع بالضمة، منجاةٌ: خبر مرفوع بالضمة",
        "الصدقُ: فاعل مرفوع، منجاةٌ: خبر مرفوع",
        "الصدقُ: مبتدأ مرفوع، منجاةٌ: نعت مرفوع"
      ],
      correctAnswer: 1,
      explanation: "الصدقُ: مبتدأ مرفوع بالضمة (وليس فاعل)، منجاةٌ: خبر مرفوع بالضمة (وليس فاعل أو نعت). الجملة اسمية وليست فعلية لأنها تبدأ باسم.",
      topic: "الجملة الاسمية - التمييز بين المبتدأ والخبر"
    },
    {
      id: 9,
      category: "الجملة الاسمية",
      question: "في الجملة: 'العلمُ في الصغر كالنقش على الحجر'، ما محل الجار والمجرور 'في الصغر'؟",
      options: [
        "في محل رفع خبر مقدم",
        "في محل رفع خبر المبتدأ",
        "في محل نصب حال",
        "لا محل له من الإعراب"
      ],
      correctAnswer: 1,
      explanation: "الجار والمجرور 'في الصغر' في محل رفع خبر للمبتدأ 'العلمُ'. الجار والمجرور يمكن أن يكون خبراً للمبتدأ إذا أتى بعد المبتدأ مباشرة.",
      topic: "الجملة الاسمية - أنواع الخبر (شبه جملة)"
    },
    {
      id: 10,
      category: "الجملة الاسمية",
      question: "أعرب 'أخوك' في: 'أخوك ذو خلق'",
      options: [
        "مبتدأ مرفوع وعلامة رفعه الضمة المقدرة",
        "مبتدأ مرفوع وعلامة رفعه الألف",
        "مبتدأ مرفوع وعلامة رفعه الواو لأنه من الأسماء الخمسة",
        "فاعل مرفوع وعلامة رفعه الواو"
      ],
      correctAnswer: 2,
      explanation: "أخوك مبتدأ مرفوع وعلامة رفعه الواو (وليس الضمة) لأنه من الأسماء الخمسة. الأسماء الخمسة (أب، أخ، حم، فو، ذو) تُرفع بالواو وتُنصب بالألف وتُجر بالياء بشروط.",
      topic: "الأسماء الخمسة - علامات إعرابها الخاصة"
    },
    {
      id: 11,
      category: "الجملة الاسمية",
      question: "في: 'الطلابُ المجتهدون ناجحون'، ما إعراب 'المجتهدون'؟",
      options: [
        "خبر مرفوع",
        "نعت مرفوع وعلامة رفعه الواو",
        "بدل مرفوع",
        "مبتدأ ثانٍ مرفوع"
      ],
      correctAnswer: 1,
      explanation: "المجتهدون نعت (صفة) مرفوع وعلامة رفعه الواو لأنه جمع مذكر سالم، والنعت يتبع المنعوت في الإعراب. 'ناجحون' هي الخبر الحقيقي للمبتدأ 'الطلابُ'.",
      topic: "النعت - التابع ومطابقته للمتبوع"
    },

    // كان وأخواتها
    {
      id: 12,
      category: "كان وأخواتها",
      question: "أعرب الجملة: 'ليس الكذبُ من شيم الكرام'",
      options: [
        "الكذبُ: اسم ليس مرفوع، من شيم: خبر ليس في محل نصب",
        "الكذبُ: مبتدأ مرفوع، من شيم: خبر مرفوع",
        "الكذبُ: فاعل مرفوع، من شيم: مفعول به منصوب",
        "الكذبُ: اسم ليس منصوب، من شيم: خبر ليس مرفوع"
      ],
      correctAnswer: 0,
      explanation: "الكذبُ: اسم ليس مرفوع (لم تتغير علامته)، من شيم: جار ومجرور في محل نصب خبر ليس. ليس من الأفعال الناقصة الناسخة، ترفع الاسم وتنصب الخبر.",
      topic: "كان وأخواتها - عمل ليس وخبرها شبه الجملة"
    },
    {
      id: 13,
      category: "كان وأخواتها",
      question: "في: 'أصبحت السماءُ صافيةً'، لماذا نُصبت 'صافيةً'؟",
      options: [
        "لأنها مفعول به",
        "لأنها خبر أصبح، وأصبح تنصب الخبر",
        "لأنها حال منصوبة",
        "لأنها نعت منصوب"
      ],
      correctAnswer: 1,
      explanation: "صافيةً خبر أصبح منصوب بالفتحة. أصبح من أخوات كان (الأفعال الناقصة الناسخة) التي ترفع الاسم وتنصب الخبر، لذلك جاء الخبر منصوباً.",
      topic: "كان وأخواتها - فهم عملها في الجملة"
    },
    {
      id: 14,
      category: "كان وأخواتها",
      question: "أعرب 'ما زال' في الجملة: 'ما زال المطرُ نازلاً'",
      options: [
        "فعل ماضٍ ناسخ",
        "حرف نفي وفعل ماضٍ تام",
        "فعل ماضٍ ناقص مبني على الفتح",
        "فعل مضارع ناقص"
      ],
      correctAnswer: 2,
      explanation: "ما زال فعل ماضٍ ناقص (وليس تام) مبني على الفتح. 'ما زال' من أخوات كان، وهي ناقصة لأنها لا تكتفي بالمرفوع بعدها (الاسم) بل تحتاج إلى المنصوب (الخبر) لتتم الفائدة.",
      topic: "كان وأخواتها - الأفعال الناقصة ومجموعاتها"
    },
    {
      id: 15,
      category: "كان وأخواتها",
      question: "في: 'بات الحارسُ ساهراً'، ما الفرق بين إعراب هذه الجملة و'نام الحارسُ'؟",
      options: [
        "لا فرق، كلاهما جملة فعلية عادية",
        "في الأولى 'الحارسُ' اسم بات مرفوع، في الثانية فاعل مرفوع",
        "في الأولى 'ساهراً' مفعول به، في الثانية لا يوجد مفعول",
        "كلاهما يحتوي على فعل ناقص"
      ],
      correctAnswer: 1,
      explanation: "في 'بات الحارسُ ساهراً': الحارسُ اسم بات مرفوع، وساهراً خبر بات منصوب (بات من أخوات كان). في 'نام الحارسُ': الحارسُ فاعل مرفوع (نام فعل تام). الفرق الجوهري أن بات فعل ناقص ونام فعل تام.",
      topic: "كان وأخواتها - الفرق بين الأفعال الناقصة والتامة"
    },

    // إن وأخواتها
    {
      id: 16,
      category: "إن وأخواتها",
      question: "أعرب: 'إنَّ الصبرَ مفتاحُ الفرج'",
      options: [
        "الصبرَ: اسم إن منصوب، مفتاحُ: خبر إن مرفوع",
        "الصبرَ: مفعول به منصوب، مفتاحُ: مبتدأ مرفوع",
        "الصبرَ: اسم إن مرفوع، مفتاحُ: خبر إن منصوب",
        "الصبرَ: مبتدأ منصوب، مفتاحُ: خبر مرفوع"
      ],
      correctAnswer: 0,
      explanation: "الصبرَ: اسم إن منصوب بالفتحة (نُصب بسبب دخول إن)، مفتاحُ: خبر إن مرفوع بالضمة. إن وأخواتها حروف ناسخة تنصب الاسم وترفع الخبر (عكس كان).",
      topic: "إن وأخواتها - عملها وتأثيرها على الجملة الاسمية"
    },
    {
      id: 17,
      category: "إن وأخواتها",
      question: "في: 'لعلَّ اللهَ يحدثُ بعد ذلك أمراً'، لماذا لم يُرفع 'يحدثُ'؟",
      options: [
        "لأنه خبر لعلّ ويجب أن يكون منصوباً",
        "لأنه فعل مضارع في جملة اسمية ويبقى على حالته",
        "لأن لعلّ تنصب الفعل المضارع",
        "لأنه جاء بعد حرف ناصب"
      ],
      correctAnswer: 1,
      explanation: "يحدثُ فعل مضارع مرفوع (يبقى على حالته الأصلية) لأنه جاء في جملة فعلية هي خبر لعلّ. لعلّ تؤثر فقط على الاسم الذي بعدها مباشرة، أما الجملة الفعلية التي هي الخبر فلا تتأثر أفعالها.",
      topic: "إن وأخواتها - الخبر الجملة الفعلية"
    },
    {
      id: 18,
      category: "إن وأخواتها",
      question: "أعرب 'كأنّ' في: 'كأنَّ الجنديَّ أسدٌ'",
      options: [
        "حرف نصب وتوكيد ونسخ",
        "حرف تشبيه ونصب ونسخ",
        "حرف تشبيه فقط",
        "فعل ناسخ مبني"
      ],
      correctAnswer: 1,
      explanation: "كأنّ حرف تشبيه ونصب ونسخ (وليس مجرد حرف تشبيه). كأنّ من أخوات إن، وتعمل عملها (تنصب الاسم وترفع الخبر)، وتفيد معنى التشبيه.",
      topic: "إن وأخواتها - معاني الحروف الناسخة"
    },
    {
      id: 19,
      category: "إن وأخواتها",
      question: "في: 'ليت الشبابَ يعودُ يوماً'، ما محل جملة 'يعودُ يوماً'؟",
      options: [
        "جملة فعلية لا محل لها من الإعراب",
        "في محل رفع خبر ليت",
        "في محل نصب خبر ليت",
        "في محل نصب مفعول به"
      ],
      correctAnswer: 1,
      explanation: "جملة 'يعودُ يوماً' جملة فعلية في محل رفع خبر ليت. الخبر يكون مرفوعاً محلاً حتى لو كان جملة فعلية، لأن إن وأخواتها ترفع الخبر.",
      topic: "إن وأخواتها - الخبر الجملة وإعرابه بالمحل"
    },

    // الجملة الفعلية
    {
      id: 20,
      category: "الجملة الفعلية",
      question: "أعرب: 'علَّم المعلمُ الطلابَ الدرسَ'",
      options: [
        "المعلمُ: فاعل، الطلابَ: مفعول به أول، الدرسَ: مفعول به ثانٍ",
        "المعلمُ: مبتدأ، الطلابَ: مفعول به، الدرسَ: خبر",
        "المعلمُ: فاعل، الطلابَ: مفعول به، الدرسَ: حال",
        "المعلمُ: نائب فاعل، الطلابَ: مفعول به، الدرسَ: تمييز"
      ],
      correctAnswer: 0,
      explanation: "المعلمُ: فاعل مرفوع، الطلابَ: مفعول به أول منصوب، الدرسَ: مفعول به ثانٍ منصوب. الفعل 'علَّم' يتعدى لمفعولين (فعل متعدٍ لمفعولين)، وليس مفعولاً واحداً.",
      topic: "الجملة الفعلية - الأفعال المتعدية لمفعولين"
    },
    {
      id: 21,
      category: "الجملة الفعلية",
      question: "في: 'يكتبُ الطالبُ الواجبَ بجدٍّ'، ما إعراب 'بجدٍّ'؟",
      options: [
        "مفعول به منصوب",
        "جار ومجرور متعلق بالفعل يكتبُ",
        "حال منصوبة",
        "نعت مجرور"
      ],
      correctAnswer: 1,
      explanation: "بجدٍّ: الباء حرف جر، جدٍّ: اسم مجرور بالكسرة، والجار والمجرور متعلق بالفعل 'يكتبُ' (يبين طريقة الكتابة). شبه الجملة هنا يعمل كوصف لحالة الفاعل.",
      topic: "الجملة الفعلية - شبه الجملة ومتعلقاتها"
    },
    {
      id: 22,
      category: "الجملة الفعلية",
      question: "أعرب 'الواجبَ' في: 'كُتِبَ الواجبُ'، ثم قارنه بـ 'كتبَ الطالبُ الواجبَ'",
      options: [
        "في الأولى مفعول به، في الثانية مفعول به (نفس الإعراب)",
        "في الأولى نائب فاعل مرفوع، في الثانية مفعول به منصوب",
        "في الأولى فاعل، في الثانية مفعول به",
        "في الأولى مبتدأ مؤخر، في الثانية مفعول به"
      ],
      correctAnswer: 1,
      explanation: "في 'كُتِبَ الواجبُ': الواجبُ نائب فاعل مرفوع (لأن الفعل مبني للمجهول وحذف الفاعل). في 'كتبَ الطالبُ الواجبَ': الواجبَ مفعول به منصوب. عند البناء للمجهول يُرفع المفعول به ليصبح نائب فاعل.",
      topic: "الجملة الفعلية - البناء للمجهول ونائب الفاعل"
    },
    {
      id: 23,
      category: "الجملة الفعلية",
      question: "في: 'قرأتُ الكتابَ'، ما إعراب التاء في 'قرأتُ'؟",
      options: [
        "لا محل لها من الإعراب لأنها حرف",
        "ضمير متصل مبني في محل رفع فاعل",
        "ضمير متصل مبني في محل نصب مفعول به",
        "ضمير منفصل في محل رفع مبتدأ"
      ],
      correctAnswer: 1,
      explanation: "التاء في 'قرأتُ' ضمير متصل مبني على الضم في محل رفع فاعل. الضمائر المتصلة في نهاية الفعل (تُ، نا، وا، ت، ن) تكون في محل رفع فاعل.",
      topic: "الجملة الفعلية - الضمائر المتصلة وإعرابها"
    },

    // جزم المضارع
    {
      id: 24,
      category: "جزم المضارع",
      question: "أعرب: 'لم يذهبوا إلى المدرسة'",
      options: [
        "يذهبوا: فعل مضارع مجزوم بلم وعلامة جزمه السكون",
        "يذهبوا: فعل مضارع مجزوم بلم وعلامة جزمه حذف النون",
        "يذهبوا: فعل مضارع منصوب بلم وعلامة نصبه حذف النون",
        "يذهبوا: فعل مضارع مرفوع وعلامة رفعه ثبوت النون"
      ],
      correctAnswer: 1,
      explanation: "يذهبوا: فعل مضارع مجزوم بلم وعلامة جزمه حذف النون (وليس السكون) لأنه من الأفعال الخمسة. الأفعال الخمسة تُجزم بحذف النون، والفعل الصحيح يُجزم بالسكون.",
      topic: "جزم المضارع - علامات الجزم المختلفة"
    },
    {
      id: 25,
      category: "جزم المضارع",
      question: "في: 'لا تنسَ ذكر الله'، لماذا حُذفت الألف من 'تنسى'؟",
      options: [
        "لأن الفعل مجزوم وعلامة جزمه حذف حرف العلة",
        "لأن الفعل منصوب وعلامة نصبه حذف الألف",
        "لأن الفعل مبني على الفتح وحُذف حرف العلة",
        "لأنها همزة وليست ألف"
      ],
      correctAnswer: 0,
      explanation: "تنسَ: فعل مضارع مجزوم بلا الناهية وعلامة جزمه حذف حرف العلة (الألف). الأفعال المعتلة الآخر (التي تنتهي بحرف علة) تُجزم بحذف حرف العلة.",
      topic: "جزم المضارع - جزم الفعل المعتل الآخر"
    },
    {
      id: 26,
      category: "جزم المضارع",
      question: "أعرب: 'إن تدرسْ تنجحْ'",
      options: [
        "تدرسْ: فعل الشرط مجزوم، تنجحْ: فعل مضارع مرفوع",
        "تدرسْ: فعل الشرط مجزوم، تنجحْ: جواب الشرط مجزوم",
        "تدرسْ: فعل مضارع منصوب، تنجحْ: فعل مضارع منصوب",
        "تدرسْ: فعل الشرط مجزوم، تنجحْ: فعل مضارع منصوب"
      ],
      correctAnswer: 1,
      explanation: "تدرسْ: فعل مضارع مجزوم لأنه فعل الشرط، تنجحْ: فعل مضارع مجزوم لأنه جواب الشرط. أدوات الشرط الجازمة تجزم فعلين: فعل الشرط وجواب الشرط.",
      topic: "جزم المضارع - أدوات الشرط الجازمة"
    },
    {
      id: 27,
      category: "جزم المضارع",
      question: "في: 'لِيكتبْ أحمدُ الواجبَ'، ما الفرق بين اللام هنا ولام التعليل؟",
      options: [
        "لا فرق، كلاهما ينصب المضارع",
        "هذه لام أمر تجزم المضارع، لام التعليل تنصبه",
        "هذه لام تعليل تنصب المضارع، لام الأمر ترفعه",
        "كلاهما يجزم المضارع"
      ],
      correctAnswer: 1,
      explanation: "اللام في 'لِيكتبْ' هي لام الأمر وتجزم الفعل المضارع. أما لام التعليل (كي، لكي) فتنصب المضارع. الفرق واضح في المعنى والعمل الإعرابي.",
      topic: "جزم المضارع - لام الأمر والفرق بينها ولام التعليل"
    },

    // الهمزات
    {
      id: 28,
      category: "الهمزات",
      question: "لماذا كُتبت الهمزة على نبرة في كلمة 'سُئِل'؟",
      options: [
        "لأن ما قبلها مفتوح",
        "لأنها مكسورة والكسرة أقوى من الضمة",
        "لأنها على وزن فُعِل",
        "لأن ما بعدها ساكن"
      ],
      correctAnswer: 1,
      explanation: "تُكتب الهمزة على نبرة (ئ) لأنها مكسورة، والكسرة أقوى الحركات. في 'سُئِل': الهمزة مكسورة وما قبلها مضموم، والكسرة أقوى من الضمة، لذا تُكتب على نبرة. ترتيب قوة الحركات: كسرة > ضمة > فتحة > سكون.",
      topic: "الهمزات - الهمزة المتوسطة وقواعد كتابتها حسب الحركات"
    },
    {
      id: 29,
      category: "الهمزات",
      question: "أيُّ من الكلمات التالية كُتبت همزتها بشكل صحيح؟",
      options: [
        "مأساة",
        "مأسات",
        "مؤمن",
        "جميع ما سبق صحيح"
      ],
      correctAnswer: 3,
      explanation: "جميع الكلمات صحيحة: 'مأساة' (على ألف: مفتوحة بعد فتح)، 'مؤمن' (على واو: مضمومة بعد ضم). معرفة الحركات وقوتها أساسية لكتابة الهمزة المتوسطة بشكل صحيح.",
      topic: "الهمزات - تطبيقات على الهمزة المتوسطة"
    },
    {
      id: 30,
      category: "الهمزات",
      question: "لماذا تُكتب 'قرأَ' بهمزة على ألف ولكن 'قرئَ' بهمزة على نبرة؟",
      options: [
        "لأن الأولى فعل ماضٍ والثانية مضارع",
        "لأن ما قبل الهمزة في 'قرأَ' مفتوح وفي 'قرئَ' مكسور",
        "لأن الأولى مبنية للمعلوم والثانية للمجهول",
        "لأن الثانية فعل معتل"
      ],
      correctAnswer: 1,
      explanation: "في 'قرأَ': الهمزة متطرفة وما قبلها مفتوح (رَ) فتُكتب على ألف. في 'قرئَ': الهمزة متطرفة وما قبلها مكسور (رِ) فتُكتب على نبرة. الهمزة المتطرفة تُكتب حسب حركة ما قبلها.",
      topic: "الهمزات - الهمزة المتطرفة وكتابتها"
    },
    {
      id: 31,
      category: "الهمزات",
      question: "ما الفرق بين همزة 'استخرج' وهمزة 'أخرج'؟",
      options: [
        "الأولى همزة وصل والثانية همزة قطع",
        "كلاهما همزة وصل",
        "الأولى همزة قطع والثانية همزة وصل",
        "كلاهما همزة قطع"
      ],
      correctAnswer: 0,
      explanation: "في 'استخرج': همزة وصل (تسقط في الوصل) لأنها في ماضي الفعل السداسي. في 'أخرج': همزة قطع (تُنطق دائماً) لأنها في الفعل الرباعي. همزة الوصل في ماضي وأمر الخماسي والسداسي فقط.",
      topic: "الهمزات - التفريق بين همزة الوصل والقطع في الأفعال"
    },

    // أسئلة متقدمة مركبة
    {
      id: 32,
      category: "أسئلة مركبة",
      question: "أعرب الجملة كاملة: 'إن المعلمين المخلصين يحبهم الطلابُ'",
      options: [
        "المعلمين: اسم إن منصوب بالياء، المخلصين: نعت منصوب بالياء، يحبهم: خبر إن جملة فعلية",
        "المعلمين: مبتدأ مرفوع، المخلصين: خبر مرفوع، يحبهم: فعل مضارع",
        "المعلمين: اسم إن منصوب بالفتحة، المخلصين: بدل منصوب، يحبهم: خبر",
        "المعلمين: مفعول به منصوب، المخلصين: حال منصوبة، يحبهم: فعل"
      ],
      correctAnswer: 0,
      explanation: "المعلمين: اسم إن منصوب وعلامة نصبه الياء (جمع مذكر سالم). المخلصين: نعت (صفة) منصوب وعلامة نصبه الياء يتبع المنعوت. يحبهم الطلابُ: جملة فعلية في محل رفع خبر إن. هنا تجتمع عدة قواعد: إن وأخواتها، النعت، علامات إعراب جمع المذكر السالم.",
      topic: "مراجعة شاملة - دمج إن وأخواتها مع النعت والجمع"
    },
    {
      id: 33,
      category: "أسئلة مركبة",
      question: "في: 'كان المعلمون يشرحون الدرسَ للطلاب'، لماذا 'يشرحون' مرفوع مع أن كان تنصب الخبر؟",
      options: [
        "لأن كان لا تؤثر على الأفعال",
        "لأن الفعل المضارع في جملة الخبر يبقى على حالته الأصلية",
        "لأن الفعل جاء بعد الاسم فلا يتأثر",
        "هذا خطأ، يجب أن يكون منصوباً"
      ],
      correctAnswer: 1,
      explanation: "يشرحون فعل مضارع مرفوع (على حالته الأصلية) لأنه جاء في جملة فعلية هي خبر كان. كان تنصب الخبر إذا كان اسماً مفرداً، أما إذا كان الخبر جملة فعلية فإن الجملة تكون في محل نصب خبر كان، ولكن الفعل نفسه يبقى على إعرابه الأصلي.",
      topic: "مراجعة شاملة - كان وأخواتها مع الخبر الجملة الفعلية"
    },
    {
      id: 34,
      category: "أسئلة مركبة",
      question: "قارن إعراب 'أبوك' في الجملتين: 'أبوك كريمٌ' و 'كان أبوك كريماً'",
      options: [
        "في الأولى والثانية: مبتدأ مرفوع بالواو",
        "في الأولى: مبتدأ مرفوع بالواو، في الثانية: اسم كان مرفوع بالواو",
        "في الأولى: مبتدأ مرفوع بالضمة، في الثانية: اسم كان مرفوع بالواو",
        "كلاهما اسم كان مرفوع بالواو"
      ],
      correctAnswer: 1,
      explanation: "في 'أبوك كريمٌ': أبوك مبتدأ مرفوع وعلامة رفعه الواو (من الأسماء الخمسة). في 'كان أبوك كريماً': أبوك اسم كان مرفوع وعلامة رفعه الواو. في الحالتين يُرفع بالواو لأنه من الأسماء الخمسة، لكن المسمى الإعرابي يختلف.",
      topic: "مراجعة شاملة - الأسماء الخمسة مع كان وأخواتها"
    },
    {
      id: 35,
      category: "أسئلة مركبة",
      question: "في: 'لم يحضر الطالبان ولم تحضر الطالبتان'، قارن علامة جزم الفعلين",
      options: [
        "كلاهما مجزوم بحذف النون",
        "الأول بالسكون، الثاني بحذف النون",
        "الأول بحذف الألف، الثاني بحذف النون",
        "الأول بحذف النون، الثاني بالسكون"
      ],
      correctAnswer: 0,
      explanation: "يحضرا (أصلها يحضران): مجزوم بحذف النون لأنه من الأفعال الخمسة. تحضرا (أصلها تحضران): مجزوم بحذف النون لأنه من الأفعال الخمسة. كلاهما فعل مضارع متصل بألف الاثنين، والأفعال الخمسة تُجزم بحذف النون.",
      topic: "مراجعة شاملة - جزم الأفعال الخمسة"
    },
    {
      id: 36,
      category: "أسئلة مركبة",
      question: "لماذا كُتبت 'مسؤول' بهذا الشكل وليس 'مسئول'؟",
      options: [
        "لأن الهمزة مضمومة",
        "لأن الهمزة مفتوحة بعد ضم (الضم أقوى من الفتح)",
        "لأن ما قبلها ساكن",
        "كلا الشكلين صحيح"
      ],
      correctAnswer: 1,
      explanation: "تُكتب 'مسؤول' بهمزة على واو لأن الهمزة مفتوحة وما قبلها مضموم (السين). الضمة أقوى من الفتحة، فتُكتب على واو. ترتيب القوة: كسرة (نبرة) > ضمة (واو) > فتحة (ألف) > سكون.",
      topic: "مراجعة شاملة - الهمزة المتوسطة وقوة الحركات"
    },

    // أسئلة تحليلية عميقة
    {
      id: 37,
      category: "تحليل متقدم",
      question: "في الجملة: 'ما زال العلماءُ يبحثون عن الحقيقة'، كم عدد الأفعال؟ وما إعرابها؟",
      options: [
        "فعل واحد: زال (ناقص مبني)، يبحثون جملة اسمية",
        "فعلان: زال (ناقص مبني)، يبحثون (مضارع مرفوع في جملة الخبر)",
        "فعلان: زال (تام مبني)، يبحثون (مضارع منصوب)",
        "ثلاثة أفعال: ما، زال، يبحثون"
      ],
      correctAnswer: 1,
      explanation: "فعلان: 'زال' فعل ماضٍ ناقص مبني على الفتح (من أخوات كان). 'يبحثون' فعل مضارع مرفوع وعلامة رفعه ثبوت النون (من الأفعال الخمسة)، والجملة الفعلية في محل نصب خبر ما زال. 'ما' حرف نفي لا محل له من الإعراب.",
      topic: "تحليل متقدم - التعامل مع الجمل المركبة"
    },
    {
      id: 38,
      category: "تحليل متقدم",
      question: "أيُّ الجملتين صحيحة إعرابياً: 'إن الطلاب المجتهدون ناجحون' أم 'إن الطلاب المجتهدين ناجحون'؟",
      options: [
        "الأولى صحيحة والثانية خطأ",
        "الثانية صحيحة والأولى خطأ",
        "كلاهما صحيح حسب السياق",
        "كلاهما خطأ"
      ],
      correctAnswer: 1,
      explanation: "الصحيح: 'إن الطلاب المجتهدين ناجحون'. المجتهدين نعت لـ 'الطلاب' (اسم إن المنصوب)، والنعت يتبع المنعوت في الإعراب، فيُنصب بالياء لأنه جمع مذكر سالم. 'المجتهدون' خطأ لأنها مرفوعة والمفروض أن تكون منصوبة.",
      topic: "تحليل متقدم - النعت ومطابقته للمنعوت في الإعراب"
    },
    {
      id: 39,
      category: "تحليل متقدم",
      question: "في: 'لم يكن الطلابُ غائبين'، لماذا 'غائبين' منصوب مع أن 'يكن' مجزوم؟",
      options: [
        "لأن الجزم يؤثر على كل ما بعده",
        "لأن غائبين خبر يكن، وكان تنصب الخبر دائماً بغض النظر عن إعراب الفعل",
        "هذا خطأ، يجب أن يكون مجزوماً",
        "لأن غائبين مفعول به وليس خبراً"
      ],
      correctAnswer: 1,
      explanation: "يكن: فعل مضارع ناقص مجزوم بلم (من كان). غائبين: خبر يكن منصوب بالياء (جمع مذكر سالم). عمل كان (نصب الخبر) مستمر حتى لو كان الفعل نفسه مجزوماً أو منصوباً. الجزم يؤثر على الفعل فقط، لا على عمله.",
      topic: "تحليل متقدم - دمج كان مع جزم المضارع"
    },
    {
      id: 40,
      category: "تحليل متقدم",
      question: "قارن: 'المؤمنون إخوة' مع 'إن المؤمنين إخوة'، ما الذي تغيّر في الإعراب؟",
      options: [
        "تغيّر فقط إعراب المؤمنون/المؤمنين",
        "تغيّر إعراب المؤمنون/المؤمنين وإخوة",
        "تغيّر نوع الجملة من فعلية إلى اسمية",
        "لم يتغيّر شيء، فقط أُضيف حرف"
      ],
      correctAnswer: 0,
      explanation: "في 'المؤمنون إخوة': المؤمنون مبتدأ مرفوع بالواو، إخوة خبر مرفوع بالضمة. في 'إن المؤمنين إخوة': المؤمنين اسم إن منصوب بالياء (تغيّر)، إخوة خبر إن مرفوع بالضمة (لم يتغيّر). إن نصبت الاسم فقط، والخبر بقي مرفوعاً.",
      topic: "تحليل متقدم - أثر الحروف الناسخة على الجملة"
    }
  ];
        // ========================================

        // App State
        let state = {
            currentQuestion: 0,
            selectedAnswer: null,
            showExplanation: false,
            score: 0,
            quizCompleted: false,
            answers: []
        };

        // Helper Functions
        function handleAnswerSelect(answerIndex) {
            if (state.selectedAnswer !== null) return;

            state.selectedAnswer = answerIndex;
            state.showExplanation = true;

            const isCorrect = answerIndex === questions[state.currentQuestion].correctAnswer;
            if (isCorrect) {
                state.score++;
            }

            state.answers.push({
                questionId: questions[state.currentQuestion].id,
                correct: isCorrect,
                category: questions[state.currentQuestion].category
            });

            render();
        }

        function handleNext() {
            if (state.currentQuestion < questions.length - 1) {
                state.currentQuestion++;
                state.selectedAnswer = null;
                state.showExplanation = false;
            } else {
                state.quizCompleted = true;
            }
            render();
        }

        function handleRestart() {
            state = {
                currentQuestion: 0,
                selectedAnswer: null,
                showExplanation: false,
                score: 0,
                quizCompleted: false,
                answers: []
            };
            render();
        }

        // SVG Icons
        const icons = {
            checkCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon" style="color: #10b981;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',
            xCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon" style="color: #ef4444;"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',
            award: '<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="trophy-icon"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>',
            bookOpen: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>'
        };

        // Render Functions
        function renderResults() {
            const percentage = Math.round((state.score / questions.length) * 100);
            let message = "";
            let colorClass = "";

            if (percentage >= 90) {
                message = "ممتاز جداً! أنت متمكن من الإعراب ومستعد تماماً للامتحان";
                colorClass = "color: #16a34a;";
            } else if (percentage >= 80) {
                message = "ممتاز! مستواك جيد جداً، راجع الأخطاء فقط";
                colorClass = "color: #22c55e;";
            } else if (percentage >= 70) {
                message = "جيد جداً! تحتاج لمراجعة بعض النقاط";
                colorClass = "color: #2563eb;";
            } else if (percentage >= 60) {
                message = "جيد! ركز على المواضيع التي أخطأت فيها";
                colorClass = "color: #ca8a04;";
            } else {
                message = "تحتاج لمزيد من المراجعة والتدريب";
                colorClass = "color: #ea580c;";
            }

            // Calculate category stats
            const categoryStats = {};
            state.answers.forEach(answer => {
                if (!categoryStats[answer.category]) {
                    categoryStats[answer.category] = { correct: 0, total: 0 };
                }
                categoryStats[answer.category].total++;
                if (answer.correct) categoryStats[answer.category].correct++;
            });

            const statsHTML = Object.entries(categoryStats).map(([cat, stats]) => {
                const pct = Math.round((stats.correct / stats.total) * 100);
                return `
                    <div class="stat-item">
                        <div class="stat-row">
                            <div class="stat-category">${cat}</div>
                            <div class="stat-score">${stats.correct}/${stats.total} (${pct}%)</div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="results-container">
                    ${icons.award}
                    <h2 class="results-title">انتهى الكويز المتقدم!</h2>
                    <div class="final-score">${state.score}/${questions.length}</div>
                    <div class="percentage">النسبة: ${percentage}%</div>
                    <p class="results-message" style="${colorClass}">${message}</p>

                    <div class="category-stats">
                        <h3 class="stats-title">
                            ${icons.bookOpen}
                            أداؤك حسب المواضيع:
                        </h3>
                        ${statsHTML.length > 0 ? statsHTML : '<p style="text-align: right; color: #6b7280;">لم يتم تسجيل إجابات.</p>'}

                        <div class="action-buttons">
                            <button class="btn-primary" onclick="handleRestart()">أعد المحاولة</button>
                            <button class="btn-secondary" onclick="window.location.reload()">خروج / إعادة تحميل</button>
                        </div>

                        <div class="final-stats">
                            <p>النقاط النهائية: <span class="final-score-value">${state.score}</span></p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderQuestion() {
            const question = questions[state.currentQuestion];
            
            const optionsHTML = question.options.map((option, index) => {
                let btnClass = "option-btn";
                let iconHTML = "";

                if (state.selectedAnswer === null) {
                    // No answer selected yet
                } else if (index === question.correctAnswer) {
                    btnClass += " correct";
                    iconHTML = icons.checkCircle;
                } else if (index === state.selectedAnswer) {
                    btnClass += " incorrect";
                    iconHTML = icons.xCircle;
                } else {
                    btnClass += " neutral";
                }

                return `
                    <button 
                        class="${btnClass}" 
                        onclick="handleAnswerSelect(${index})"
                        ${state.selectedAnswer !== null ? 'disabled' : ''}
                    >
                        <span style="text-align: right; line-height: 1.75;">${option}</span>
                        ${iconHTML}
                    </button>
                `;
            }).join('');

            const explanationHTML = state.showExplanation ? `
                <div class="explanation-box ${state.selectedAnswer === question.correctAnswer ? 'correct' : 'incorrect'}">
                    <p class="explanation-title">
                        ${state.selectedAnswer === question.correctAnswer ? '✅ إجابة صحيحة! ممتاز' : '❌ إجابة خاطئة'}
                    </p>
                    <div class="explanation-content">
                        <p class="explanation-text">
                            <strong>الشرح التفصيلي:</strong><br>
                            ${question.explanation}
                        </p>
                    </div>
                    <div class="topic-info">
                        ${icons.bookOpen}
                        <p><strong>راجع:</strong> ${question.topic}</p>
                    </div>
                </div>
                <button class="next-btn" onclick="handleNext()">
                    ${state.currentQuestion < questions.length - 1 ? 'السؤال التالي ←' : 'إنهاء الكويز وعرض النتائج 🎉'}
                </button>
            ` : '';

            return `
                <div class="header">
                    <h1>كويز الإعراب المتقدم</h1>
                    <div class="score-info">
                        <div class="question-number">السؤال ${state.currentQuestion + 1} من ${questions.length}</div>
                        <div class="score">النقاط: ${state.score}</div>
                    </div>
                </div>

                <div class="question-container">
                    <h2 class="category">${question.category}</h2>
                    <p class="question">${question.question}</p>

                    <div class="options">
                        ${optionsHTML}
                    </div>

                    ${explanationHTML}

                    <div class="current-score">
                        <p>النتيجة الحالية: <span class="score-value">${state.score}</span> من ${state.currentQuestion + (state.selectedAnswer !== null ? 1 : 0)}</p>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button class="restart-btn" onclick="handleRestart()">إعادة البدء</button>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            if (questions.length === 0) {
                app.innerHTML = '<div class="results-container"><h2 class="results-title">الرجاء إضافة الأسئلة في ملف HTML</h2><p style="text-align: center; margin-top: 1rem; color: #6b7280;">ابحث عن "PASTE YOUR QUESTIONS ARRAY HERE" في الكود</p></div>';
                return;
            }
            
            if (state.quizCompleted) {
                app.innerHTML = renderResults();
            } else {
                app.innerHTML = renderQuestion();
            }
        }

        // Initial render
        render();
    </script>
</body>
</html>