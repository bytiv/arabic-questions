<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>امتحانات لتحضير الفاينال</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container" id="app"></div>

    <script>

const examSets = [
  {
    title: "حركة الديستيل (1917-1931): فلسفة، عمارة وتصميم",
    questions: [
      {
        id: 1,
        category: "النشأة والفلسفة",
        question: "ما العلاقة الجوهرية بين رفض الديستيل للأشكال الطبيعية وسعيها نحو 'العالمية' في الفن؟",
        options: [
          "الأشكال الطبيعية تعتمد على الإدراك الفردي، بينما الأشكال الهندسية المجردة تمثل لغة بصرية كونية.",
          "الأشكال الطبيعية صعبة الرسم ولا تتناسب مع مهارات جميع الفنانين في ذلك الوقت.",
          "الطبيعة كانت مرتبطة بالحروب، فابتعدوا عنها للبحث عن السلام النفسي.",
          "الأشكال الهندسية كانت موضة سائدة في أوروبا بعد الحرب العالمية الأولى."
        ],
        correctAnswer: 0,
        explanation: "رفض الديستيل للأشكال الطبيعية جاء من ارتباطها بـ'الفردانية' التي تمنع الشمولية، بينما التجريد الهندسي يهدف لخلق لغة كونية.",
        topic: "من الفردي إلى الكوني: أسس التجريد"
      },
      {
        id: 2,
        category: "التاريخ والنقد",
        question: "كيف يمكن فهم العبارة التي تقول إن الديستيل 'امتلكت التاريخ في باطنها' رغم رفضها للتقاليد؟",
        options: [
          "لأنها حفظت الأعمال الفنية القديمة في متاحف خاصة بها.",
          "لأن منهجيتها الجذرية جعلت منها لحظة تاريخية مؤثرة رغم رفضها للماضي.",
          "لأنها استخدمت تقنيات تاريخية في إنتاج أعمال حديثة.",
          "لأنها درست تاريخ الرياضيات وتطبيقه في الفن."
        ],
        correctAnswer: 1,
        explanation: "الحركة رفضت الاستناد للتقاليد لكن إبداعها الجذري جعلها جزءاً مؤثراً من تاريخ تطور الفن الحديث.",
        topic: "مفارقة الرفض والبقاء في التاريخ الفني"
      },
      {
        id: 3,
        category: "التحليل المعماري",
        question: "ما الجانب الذي يُعزى تحديداً للنحات عند تحليل مبنى فيلا هيني حسب النص؟",
        options: [
          "دراسة توزيع الحمولات الإنشائية ومواد البناء المستخدمة.",
          "تحليل العلاقات بين الكتل والأحجام والفراغات المحيطة.",
          "تقييم كفاءة التصميم من حيث التكلفة والتنفيذ العملي.",
          "فحص ملاءمة الألوان المستخدمة للوظيفة الداخلية."
        ],
        correctAnswer: 1,
        explanation: "النص يفصل أن تحليل النحات يكون 'حيث الشكل والفراغ'، أي دراسة العلاقات المجسمة والفضائية.",
        topic: "التخصص في التحليل المعماري متعدد الزوايا"
      },
      {
        id: 4,
        category: "الرمزية والتأويل",
        question: "ما الدلالة الرمزية للون الأحمر في النظام اللوني للديستيل كما ورد؟",
        options: [
          "يرمز إلى الطاقة الثورية والتغيير الجذري في المجتمع.",
          "يمثل العلاقة والتفاعل بين عنصري الضوء والبناء.",
          "يشير إلى الدماء والحرب التي سبقت نشأة الحركة.",
          "يرمز إلى العواطف الإنسانية والمشاعر الجياشة."
        ],
        correctAnswer: 1,
        explanation: "النص يذكر أن الأحمر 'يمثل العلاقة المشتركة بينهما'، أي بين الضوء (الأصفر) والعمارة (الأزرق).",
        topic: "الدلالات العلائقية في النظام اللوني"
      },
      {
        id: 5,
        category: "المقارنات الفلسفية",
        question: "ما الفرق بين نظرة فانتونجرلو للرياضيات ورؤية موندريان للفن 'النقي'؟",
        options: [
          "الرياضيات أداة لفهم الموضوعي، والفن تعبير عن العقل المجرد.",
          "الرياضيات للعقل فقط، والفن للعواطف والمشاعر فقط.",
          "الرياضيات تحتاج للفن، لكن الفن لا يحتاج للرياضيات.",
          "الرياضيات أكثر دقة من الفن، والفن أكثر جمالاً منها."
        ],
        correctAnswer: 0,
        explanation: "فانتونجرلو رأى الرياضيات كطريق لفهم الموضوعي، بينما موندريان رأى الفن النقي كتعبير عن العقل المجرد.",
        topic: "المنطق الرياضي مقابل التعبير الجمالي المجرد"
      },
      {
        id: 6,
        category: "تحليل الأثاث",
        question: "ما الذي يجعل إنشاء مقعد ريتفيلد الأحمر والأزرق يُوصف بأنه 'جدلي'؟",
        options: [
          "لأنه صُمم بعد جدالات طويلة بين أعضاء الحركة حول شكله.",
          "لأنه يجمع بين أضداد كالاستقلال والترابط في تناغم واحد.",
          "لأنه يستخدم تقنية تعاشيق خشبية معقدة تسمى 'التعشيق الجدلي'.",
          "لأنه يمثل حلولاً عملية لمشكلات التصميم المعقدة."
        ],
        correctAnswer: 1,
        explanation: "الإنشاء الجدلي يتجلى في جمع الأضداد: أجزاء مستقلة في وحدة كلية، وألوان متضادة في تناغم.",
        topic: "فلسفة التصميم: وحدة الأضداد"
      },
      {
        id: 7,
        category: "التكامل بين الفنون",
        question: "أي فنان يُعتبر الجسر الرئيسي لنقل مبادئ التصوير الديستيلي إلى العمارة؟",
        options: [
          "ثيو فان ديسبرج لقيادته الفكرية والنظرية للحركة.",
          "جريت ريتفيلد لتحويل المبادئ التجريدية إلى واقع معماري.",
          "بيتر زوارت لدمجه بين العمارة والتصميم الجرافيكي.",
          "فانتونجرلو لتركيزه على الأسس الرياضية للتكوين."
        ],
        correctAnswer: 1,
        explanation: "ريتفيلد هو من نقل المبادئ التصويرية لموندريان إلى العمارة والأثاث عبر أعمال كمنزل شرودر.",
        topic: "الترجمة بين الوسائط الفنية المختلفة"
      },
      {
        id: 8,
        category: "الفهم الدقيق للنص",
        question: "ما المقصود بـ 'استبدالها' في عبارة النص عن هدف الديستيل باستبدالها بأشكال هندسية؟",
        options: [
          "استبدال العمارة التقليدية بعمارة حديثة تعتمد الخرسانة.",
          "استبدال الفن التشخيصي بفن تجريدي خالص.",
          "استبدال الأشكال الطبيعية العضوية بأشكال هندسية مجردة.",
          "استبدال الألوان الترابية بالألوان الأساسية الصارخة."
        ],
        correctAnswer: 2,
        explanation: "الضمير 'ها' يعود على 'الطبيعة'، فالهدف كان استبدال تعبيراتها بأشكال هندسية مجردة.",
        topic: "المشروع التأسيسي: التحرر من المرجع الطبيعي"
      },
      {
        id: 9,
        category: "المصطلحات والمفاهيم",
        question: "ما المقصود بمصطلح 'تايبوتيكت' الذي صاغه بيتر زوارت؟",
        options: [
          "نظرية في دمج العمارة مع تقنيات الطباعة الحديثة.",
          "أسلوب في الكتابة يعتمد على الأشكال الهندسية.",
          "تقنية بناء تستخدم الألواح الطباعية كمواد إنشائية.",
          "دمج مبادئ التصميم المعماري مع تصميم الطباعة."
        ],
        correctAnswer: 3,
        explanation: "المصطلح يعني دمج Typography (الطباعة) مع Architecture (العمارة)، ويعكس تكامل المجالين.",
        topic: "التوليف الإبداعي بين التخصصات المختلفة"
      },
      {
        id: 10,
        category: "الوظيفة والتطبيق",
        question: "بماذا يختلف دور اللون في أثاث ريتفيلد عنه في لوحات موندريان؟",
        options: [
          "في الأثاث، اللون له وظيفة إنشائية تبرز البنية والفراغ.",
          "في الأثاث، اللون يستخدم للزخرفة والتجميل فقط.",
          "في اللوحات، اللون أكثر تعقيداً وتدرجاً من الأثاث.",
          "في اللوحات، اللون يخضع لقوانين فيزيائية دقيقة."
        ],
        correctAnswer: 0,
        explanation: "في التصميم ثلاثي الأبعاد، يُستخدم اللون لإبراز البنية الإنشائية والعلاقات الفراغية.",
        topic: "تطور وظيفة اللون حسب طبيعة الوسيط الفني"
      },
      {
        id: 11,
        category: "المفارقات الداخلية",
        question: "أي مما يلي يمثل مفارقة داخلية في مشروع الديستيل؟",
        options: [
          "سعيها للكونية بينما نشأت من سياق محلي وفردي واضح.",
          "استخدامها لألوان أساسية بدائية رغم تقدم فلسفتها.",
          "كونها حركة هولندية تستخدم مصطلحات إنجليزية.",
          "تصميماتها البسيطة التي تنتج بتكاليف عالية."
        ],
        correctAnswer: 0,
        explanation: "المفارقة في سعيها لخلق لغة كونية مجردة بينما ولدت من خصوصية مكانية وزمنية محددة.",
        topic: "مفارقة الكوني المنبثق من المحلي"
      },
      {
        id: 12,
        category: "المقارنة التاريخية",
        question: "ما الحركة التي يضعها النص كمنافس رئيسي للديستيل في تشكيل الحداثة؟",
        options: [
          "التكعيبية كحركة سابقة وممهدة للتجريد.",
          "الباوهاوس كحركة معاصرة ذات طموح مماثل.",
          "التركيبية الروسية كحركة متشابهة في الأسلوب.",
          "الانطباعية كنقيض جمالي وفلسفي لها."
        ],
        correctAnswer: 1,
        explanation: "يذكر النصر صراحة قدرة الديستيل على 'المنافسة مع المشروعات الأخرى كالباوهاوس'.",
        topic: "الديستيل في سياق الحداثة التنافسية"
      }
    ]
  },
  {
    title: "الحداثة المتأخرة وما بعد الحداثة: فلسفة، عمارة وتصميم",
    questions: [
      {
        id: 1,
        category: "النشأة والسياق التاريخي",
        question: "ما السبب الرئيسي الذي قاد، بحسب النص، إلى ظهور حركة 'الحداثة المتأخرة'؟",
        options: [
          "ردة فعل على نجاح الحركة الحديثة وتطلعاً لمزيد من التطور التكنولوجي.",
          "وصول الحركة الحديثة إلى طريق مسدود وملل الناس من أشكالها الرتيبة وغياب البعد الاجتماعي.",
          "اكتشاف مواد بناء جديدة فرضت أشكالاً معمارية أكثر تعقيداً.",
          "تأثير الفلسفات الشرقية التي دعت إلى العودة إلى الروحانيات في الفن والعمارة."
        ],
        correctAnswer: 1,
        explanation: "النص يوضح أن الحركة الحديثة استمرت حتى أواخر الستينات حتى 'استنفذت أغراضها وأصبحت تواجه طريقاً مسدودا بعدما أصاب الناس الملل لأشكالها الرتيبة وغياب البعد الاجتماعي والانفصال عن التاريخ'، مما مهّد لظهور تيارات جديدة.",
        topic: "أزمة الحداثة وولادة ما بعدها"
      },
      {
        id: 2,
        category: "التعريفات والمصطلحات",
        question: "كيف يميز تشارلز جينكز بين 'الحداثة المتأخرة' و'ما بعد الحداثة'؟",
        options: [
          "الحداثة المتأخرة ترفض التكنولوجيا، بينما ما بعد الحداثة تحتضنها.",
          "كلاهما مصطلحان لنفس الشيء، يعيشان في عصر ما بعد الصناعة.",
          "الحداثة المتأخرة تستخدم دوافع الحداثة إلى أقصى درجة، بينما ما بعد الحداثة تنفصل عنها.",
          "الحداثة المتأخرة تهتم بالشكل فقط، وما بعد الحداثة بالوظيفة فقط."
        ],
        correctAnswer: 2,
        explanation: "يذكر النص أن جينكز يقول مصطلح الحداثة المتأخرة 'يستخدِم دوافع الحداثة إلى اقصى درجة'، ويؤكد على ضرورة التفريق بينه وبين ما بعد الحداثة، معتبراً أن خلط المصطلحين كخلط الكاثوليك بالبروتستانت.",
        topic: "التفريق بين المصطلحات المتداخلة"
      },
      {
        id: 3,
        category: "اتجاهات الحداثة المتأخرة",
        question: "أي من الاتجاهات التالية يعد جزءاً من 'الحداثة المتأخرة' ويهتم بالبساطة والتجريد والنقاء في أقصى حدود ممكنة؟",
        options: [
          "التاريخية (Historicism)",
          "الاخترالية (Minimalism)",
          "التعبيرية الجديدة (Neo-Expressionism)",
          "الحضرية العشوائية (Ad-Hoc Urbanist)"
        ],
        correctAnswer: 1,
        explanation: "النص يحدد 'الاخترالية Minimalism' كأحد أهم اتجاهات الحركة الحديثة المتأخرة، والتي 'تعتنق البساطة والتجريد والنقاء في أقصى حدود ممكنة'.",
        topic: "اتجاهات الحداثة المتأخرة: الاخترالية"
      },
      {
        id: 4,
        category: "أسس ما بعد الحداثة",
        question: "ما الهدف الأساسي الذي سعت الحركة ما بعد الحديثة لتحقيقه من خلال 'البحث في الماضي'؟",
        options: [
          "نسخ الأعمال المعمارية التاريخية بدقة لأغراض الحفظ والترميم.",
          "إحياء الطرز التاريخية بصورتها الأصلية دون تعديل.",
          "إحضار الحكمة القديمة عبر المعارف الحديثة لخلق علاقة تبادلية بين الجديد والقديم.",
          "إثبات تفوق التقنيات الحديثة على البنى القديمة."
        ],
        correctAnswer: 2,
        explanation: "تنص الحركة ما بعد الحديثة على أن هدفها هو 'البحث في الماضي بهدف احضار الحكمة القديمة عبر المعارف الحديثة، فالجديد سوف يحيي القديم، والقديم يمنح الفاعلية والحيوية للجديد'.",
        topic: "العلاقة مع التاريخ في ما بعد الحداثة"
      },
      {
        id: 5,
        category: "سمات ما بعد الحداثة",
        question: "أي من السمات التالية تعتبر من أبرز سمات الأعمال ما بعد الحديثة، وتنتج عن استخدام التعقيد والتناقض والمجاز؟",
        options: [
          "الوضوح (Clarity)",
          "الغموض (Ambiguity)",
          "الوظيفية الصرفة (Pure Functionality)",
          "الاستدامة (Sustainability)"
        ],
        correctAnswer: 1,
        explanation: "يذكر النص أن 'الغموض Ambiguity' يعتبر سمة هامة تنسب للأعمال ما بعد الحديثة نتيجة 'لاستخدام العديد من المظاهر كالتعقيد والتناقض والمجاز والميتافيزيقا...' والتي تثري العمل بقراءات متعددة.",
        topic: "سمات ما بعد الحداثة: الغموض والتعددية"
      },
      {
        id: 6,
        category: "نقد الحداثة",
        question: "على أي أساس هاجمت جان جاكوبس التخطيط الحضري الحديث؟",
        options: [
          "على أساس ارتفاع تكاليفه مقارنة بالتخطيط التقليدي.",
          "لعدم استخدامه مواد بناء صديقة للبيئة.",
          "لأن مساحاته كانت نظيفة ومادية لكنها ميتة اجتماعياً وروحياً، مقابل حيوية النسيج الحضري القديم.",
          "لأنه تجاهل الحاجة إلى مواقف السيارات الكافية."
        ],
        correctAnswer: 2,
        explanation: "هاجمت جاكوبس المساحات الحضرية الحديثة بقولها: 'كانت نظيفة ومنظمة من الناحية المادية، أما من الناحية الاجتماعية والروحية فهي أقرب إلى الموت'، مشيدةً بحيوية النسيج الحضري التقليدي.",
        topic: "النقد الاجتماعي للعمارة الحديثة"
      },
      {
        id: 7,
        category: "الأساليب الفنية",
        question: "ما المقصود بالأسلوب 'الإقليمية الجديدة (Neo-Vernacular)' في عمارة ما بعد الحداثة؟",
        options: [
          "عمارة تفرض نمطاً عالمياً موحداً على جميع الأقاليم.",
          "عمارة تعيد إنتاج الطرز التاريخية الأوروبية في جميع أنحاء العالم.",
          "عمارة تتفاعل مع البيئة الجغرافية والاجتماعية والتاريخية للإقليم لتنتج عمارة محلية متجانسة مع بيئتها.",
          "عمارة تستخدم تقنيات البناء المتقدمة فقط، متجاهلة المواد المحلية."
        ],
        correctAnswer: 2,
        explanation: "العمارة الإقليمية الجديدة 'تتنوع طبقا للإقليم الذي تعيش فيه متفاعلة مع بيئته الجغرافية والاجتماعية والاقتصادية والتاريخية' وتدعو للاستفادة من الأساليب المحلية الموروثة.",
        topic: "التكيف مع المحلي والخصوصية الثقافية"
      },
      {
        id: 8,
        category: "التقنيات والمفاهيم",
        question: "في سياق ما بعد الحداثة، ما دور 'الزخرفة (Ornament)' الذي أعيدت له قيمته بعد هجوم الحداثة عليه؟",
        options: [
          "دور وظيفي بحت في تحمل الأحمال الإنشائية.",
          "دورها الرمزي والاستطيقي في إضفاء التناغم البصري وكسر رتابة الكتل الضخمة.",
          "دور ثانوي للتجميل فقط، كما كان الحال في العصور الكلاسيكية.",
          "لا دور لها؛ ظلت ما بعد الحداثة ترفضها كما رفضتها الحداثة."
        ],
        correctAnswer: 1,
        explanation: "أعاد رواد ما بعد الحداثة الاعتبار للزخرفة لدورها 'الرمزي بالإضافة إلى الجوانب الاستطيقية'، حيث 'تبطل مفعول كتلة البناء ذات المقياس الضخم وتكسبها أبعاد مختلفة'.",
        topic: "إعادة اكتشاف الزخرفة"
      },
      {
        id: 9,
        category: "المقارنات الفلسفية",
        question: "كيف يتصور فراغ ما بعد الحديث (Post-Modern Space) العلاقة بين الداخل والخارج، مقارنةً بفراغ الحداثة؟",
        options: [
          "يسعى لجعل العلاقة بين الداخل والخارج مفتوحة ومستمرة تماماً دون عوائق، كتعبير عن الحرية.",
          "يتقبل ويؤكد على التضاد والتصادم بين الداخل والخارج، مما يقوي شكل العمارة ويخلق حدثاً معمارياً عند الجدار.",
          "يلغي مفهوم الفراغ الداخلي تماماً لصالح فراغ خارجي موحد.",
          "يقلد تماماً الفراغ المغلق والمحدد للعمارة ما قبل الصناعية."
        ],
        correctAnswer: 1,
        explanation: "يذكر النص أن فراغ ما بعد الحديث يرفض فكرة الفراغ المنساب المستمر للحداثة، ويؤكد أن 'التضاد والتصادم بين الداخل والخارج يقوي شكل العمارة الخارجية ويجعل الحائط حدث معماري'.",
        topic: "فلسفة الفراغ في ما بعد الحداثة"
      },
      {
        id: 10,
        category: "التكامل بين الفنون",
        question: "كيف عُبّر عن فكرة 'التعددية والهجين (Pluralism & Hybrid)' في عمارة وتصميم ما بعد الحداثة؟",
        options: [
          "من خلال الاعتماد على نمط واحد نقى ومحدد المصادر.",
          "من خلال خلق مزيج معقد من الموضوعات والطرز المتنوعة، احتراماً للثقافات المحلية والرغبة في عبور الثقافات.",
          "من خلال استخدام المواد الصناعية فقط وتجنب أي إشارات تقليدية.",
          "من خلال تبني الشكل المربع والمكعب كأشكال وحيدة مسموح بها."
        ],
        correctAnswer: 1,
        explanation: "يصف النص التعددية والهجين بأنها تستخدم 'لوصف المزيج المعقد من الموضوعات والطرز المتنوعة... والتي تهدف لاحترام الثقافات المحلية التي تصاحب عملية التحديث والرغبة في الانطلاق عبر الثقافات المختلفة'.",
        topic: "التعددية والهجين كسمة أساسية"
      },
      {
        id: 11,
        category: "أهم الرواد",
        question: "أي من المعماريين التاليين يُعتبر من أهم رواد 'جماليات الآلة (Machine Aesthetic)' أو 'التكنولوجيا المتقدمة (High-Tech)' في الحداثة المتأخرة؟",
        options: [
          "مايكل جريفز (Michael Graves)",
          "تشارلز مور (Charles Moore)",
          "نورمان فوستر (Norman Foster)",
          "ألدو روسي (Aldo Rossi)"
        ],
        correctAnswer: 2,
        explanation: "يذكر النص أن 'نورمان فوستر' هو أحد أبرز رواد اتجاه 'جماليات الآلة' أو 'التكنولوجيا المتقدمة High-Tech' الذي يؤمن بأن 'العمارة لصيقة بالتقدم وانعكاسا للتكنولوجيا في كل العصور'.",
        topic: "رواد الحداثة المتأخرة وتكنولوجيا البناء"
      },
      {
        id: 12,
        category: "الخلاصة والتقييم",
        question: "كيف تختتم الحركة ما بعد الحديثة علاقتها مع الحداثة، بحسب النص؟",
        options: [
          "بتخلي كامل وقطيعة تامة مع كل مبادئ وأشكال الحداثة.",
          "بتوسيع لغة الحداثة وتطويرها في اتجاهات جديدة تشمل العالمية والتراث التقليدي واللهجات المحلية، للتعبير عن تحديات العصر الجديد.",
          "بالعودة الكاملة إلى أساليب عصر النهضة والكلاسيكية باعتبارها الأكمل.",
          "بتجميد تطور العمارة والتصميم عند إنجازات الحداثة المتأخرة."
        ],
        correctAnswer: 1,
        explanation: "يخلص النص إلى أن الحركة ما بعد الحديثة 'تتضاد مع نوع معين من الحداثة لا بالتخلي عنها بل بالتوسع في لغتها في شتى الاتجاهات نحو العالمية والتراث التقليدي واللهجات الدارجة'.",
        topic: "العلاقة التطورية بين الحداثة وما بعدها"
      }
    ]
  },
  {
    title: "مفاهيم ومبادئ العمارة التفكيكية",
    questions: [
      {
        id: 1,
        category: "النشأة والتعريف",
        question: "كيف يمكن وصف ظهور حركة التفكيكية في العمارة من الناحية التاريخية والفكرية؟",
        options: [
          "كانت تطوراً طبيعياً ومستقيماً لفلسفة ما بعد الحداثة دون قطيعة معها.",
          "ظهرت كرد فعل على نمطية وإفراط في تبسيط أشكال عمارة الحداثة.",
          "تمثل استمرارية وتأكيداً لمبادئ البنائية الروسية دون إضافة جوهرية.",
          "كانت حركة تهدف إلى إحياء الزخارف الكلاسيكية بأسلوب تقني حديث."
        ],
        correctAnswer: 1,
        explanation: "ظهرت التفكيكية كرد فعل ورفض لنمطية وإفراط تبسيط أشكال عمارة الحداثة (Modernism) التي تمحورت حول شكل المكعب ومبدأ 'الشكل يتبع الوظيفة'.",
        topic: "النشأة التاريخية للتفكيكية"
      },
      {
        id: 2,
        category: "الماهية والأهداف",
        question: "ما هو المبدأ الأساسي الذي تقوم عليه النظرية التفكيكية في التعامل مع عناصر التصميم؟",
        options: [
          "السعي لتحقيق الانسجام والوحدة الكاملة بين جميع مفردات العمل المعماري.",
          "الالتزام الصارم بالأصول والقواعد التاريخية مع تحديث المواد المستخدمة.",
          "الاختلاف ورفض الوحدة بين العناصر، مع الاعتماد على نظرية الشك في البنية.",
          "إعطاء الأولوية المطلقة للوظيفة العملية على حساب الشكل الجمالي."
        ],
        correctAnswer: 2,
        explanation: "تقوم التفكيكية على الاختلاف ورفض الوحدة بين عناصر التصميم، مستندة إلى نظرية الشك في البنية الأساسية للمكونات، وهو ما يخلق جماليتها من التنافر وعدم الترابط.",
        topic: "الأساس النظري للتفكيكية"
      },
      {
        id: 3,
        category: "المصادر الفلسفية",
        question: "أي من المذاهب الفلسفية التالية يرتبط ارتباطاً مباشراً بفكرة 'فقدان المركز' التي انعكست على التصميم التفكيكي؟",
        options: [
          "المذهب البراغماتي الذي يركز على النفعية والتجربة.",
          "مذهب العدمية الذي يؤكد على انعدام المركز والمعنى الثابت.",
          "مذهب البيئية الذي يبحث عن الحالة الوسطى بين المرئي والمدرك.",
          "مذهب التناظر الذي يساوي بين أضداد مثل الشكل والوظيفة."
        ],
        correctAnswer: 1,
        explanation: "مذهب العدمية (Nihilism)، المتأثر بالوجودية، قاد إلى فكرة 'فقدان المركز' والتي عبر عنها معماريو التفكيكية مثل بيتر أيزنمان في أشكال غير متماثلة ولامركزية.",
        topic: "تأثير الفلسفة على التفكيكية"
      },
      {
        id: 4,
        category: "أنواع التصميم",
        question: "ما الذي يميز 'التصميم التناظري' (ANALOGIC DESIGN) في المنهج التفكيكي؟",
        options: [
          "اعتماده على قواعد هندسية صارمة مستمدة من قواعد تركيب الجمل اللغوية.",
          "اشتقاق الشكل النهائي من خلال تجريد وترميز عناصر أو أفكار فلسفية مجردة.",
          "الاستلهام المباشر من الأشكال الطبيعية أو أجزاء منها لخلق تصميم يوحي بها.",
          "اتباع منهج التجربة والخطأ للتعرف على سلوك المواد وخواصها المختلفة."
        ],
        correctAnswer: 2,
        explanation: "يتميز التصميم التناظري في التفكيكية بالاستلهام المباشر من الأشكال الطبيعية (كالأصداف والطيور) لخلق تصميم يوحي بها، كما في أعمال فرانك جيري.",
        topic: "أنماط التصميم التفكيكي"
      },
      {
        id: 5,
        category: "الرواد والممارسون",
        question: "بأي مفهوم يصف المعماري برنارد تشومي (Bernard Tschumi) حركة التفكيكية؟",
        options: [
          "يرى أنها تدمير كامل للماضي وقطع تام مع جميع الأيدلوجيات السابقة.",
          "يصفها بأنها إعادة بناء (Reconstruction) وليست تدميراً، وتركز على الابتكار.",
          "يعتبرها مجرد نسخة معدلة وأكثر تعقيداً من جماليات المذهب الحديث.",
          "يحددها كحركة تهدف لإحياء الترتيب النظامي الكلاسيكي بأدوات جديدة."
        ],
        correctAnswer: 1,
        explanation: "برنارد تشومي يصف التفكيكية بأنها 'إعادة بناء' وليست تدميراً، ويركز على أنها فن يتميز بعدم التطابق والتشابه، ويجب أن يحمل الابتكار كأهم عنصر.",
        topic: "رؤى رواد التفكيكية"
      },
      {
        id: 6,
        category: "المميزات الشكلية",
        question: "أي من الخصائص التالية لا تُعد من السمات الشكلية البارزة للعمارة التفكيكية؟",
        options: [
          "الاستخدام المتكرر للأشكال الهندسية البسيطة والنقية مثل المكعب والكرة.",
          "توظيف تراكيب هندسية مركبة وأشكال متصادمة في زوايا ديناميكية.",
          "ظهور أشكال حادة، وكتل متراكبة (Overlapping)، وانحرافات غير تقليدية.",
          "تبني جماليات نابعة من اللاتماثل واللامركزية والتجريد المبالغ فيه."
        ],
        correctAnswer: 0,
        explanation: "الاعتماد على الأشكال الهندسية البسيطة والنقية (كالمكعب) هو سمة أساسية للحداثة. التفكيكية تميزت بتفكيك تلك الأشكال وخلق تراكيب معقدة ومتصادمة منها.",
        topic: "السمات الشكلية للتفكيكية"
      },
      {
        id: 7,
        category: "الأهداف والغايات",
        question: "ما أحد الأهداف الرئيسية التي تسعى التفكيكية إلى تحقيقه في الفراغ المعماري؟",
        options: [
          "خلق فراغ وحيد متعدد الاستخدامات يصلح لأي وظيفة كانت، كما سعت الحداثة.",
          "تصميم فراغات جديدة تحقق جميع الوظائف المطلوبة في أنجح صورة، مع رفض فكرة الفراغ الواحد الشامل.",
          "الرجوع إلى الفراغات الكلاسيكية المزخرفة مع تحسين أدائها الوظيفي بالتكنولوجيا.",
          "إعطاء الأولوية القصوى لكفاءة الأداء الوظيفي على حساب أي اعتبار جمالي أو تعبيري."
        ],
        correctAnswer: 1,
        explanation: "تهدف التفكيكية إلى خلق فراغات معمارية جديدة تحقق جميع الوظائف المرجوة في أنجح صورها، مع رفض منطق الحداثة الذي حاول صنع فراغ واحد (كالمكعب) صالح لكل الاستخدامات.",
        topic: "أهداف التفكيكية في التصميم الداخلي"
      },
      {
        id: 8,
        category: "المفاهيم الفلسفية",
        question: "كيف تتجلى فكرة 'الآخرية' أو 'الاختلاف' (Difference/Otherness) في التصميم التفكيكي؟",
        options: [
          "من خلال السعي لتحقيق الشكل المثالي والنموذج الأصلي الذي لا تشوبه شائبة.",
          "بإخفاء معاني رمزية مباشرة وواضحة خلف الشكل الظاهري للمبنى لتسهيل الفهم.",
          "باحتواء العمل على معاني ضمنية وقراءات مختلفة تختلف باختلاف المتلقي وظروفه.",
          "عن طريق اتباع مصدر واحد أصيل وواضح للحقيقة الجمالية والمعمارية."
        ],
        correctAnswer: 2,
        explanation: "تتجلى 'الآخرية' في احتواء النص المعماري (المبنى) على معاني ضمنية و'نص آخر' مختلف، يسمح بقراءات لانهائية تتغير بتغير ظروف وخلفية المشاهد أو المتلقي.",
        topic: "تطبيق الفلسفة في التصميم"
      },
      {
        id: 9,
        category: "رواد التفكيكية",
        question: "ما المصدر الأساسي الذي استلهم منه فرانك جيري (Frank Gehry) العديد من مفرداته التصميمية؟",
        options: [
          "الزخارف والأشكال الكلاسيكية اليونانية والرومانية بأسلوب معاصر.",
          "الأعمال الأدبية والنظريات النقدية الخاصة بما بعد البنيوية.",
          "الأشكال الطبيعية العضوية مثل الأسماك والأصداف والثعابين.",
          "التراكيب الهندسية المجردة لأعمال فناني التكعيبية والبنائية."
        ],
        correctAnswer: 2,
        explanation: "استلهم فرانك جيري مفرداته من الأشكال الطبيعية العضوية (كالأسماك) مباشرة، وليس من مصادر وسيطة، مؤكداً على فكرة 'الآخرية' بأن يقدم حياة مجسدة وليس الشيء نفسه.",
        topic: "مصادر إلهام فرانك جيري"
      },
      {
        id: 10,
        category: "النقد والمقارنة",
        question: "كيف تختلف نظرة التفكيكية لعلاقة 'الشكل والوظيفة' عن نظرة حركة الحداثة (Modernism)؟",
        options: [
          "تتفق مع الحداثة في إعطاء الأولوية المطلقة للوظيفة الاقتصادية على الشكل.",
          "ترى أن الشكل يجب أن يتبع الوظيفة تماماً، لكن بأسلوب تقني أكثر تعقيداً.",
          "تؤمن بأن الشكل والوظيفة يحملان نفس الأهمية ويتواجدان جنباً إلى جنب.",
          "تعطي الأولوية للشكل التعبيري والجمالي حتى لو على حساب الوظيفة العملية."
        ],
        correctAnswer: 2,
        explanation: "على عكس الحداثة التي أعطت الأولوية للوظيفة (مبدأ الشكل يتبع الوظيفة)، ترى التفكيكية أن الشكل والوظيفة متساويان في الأهمية ويقفان جنباً إلى جنب، حيث يحمل الشكل معاني ورموزاً بذاته.",
        topic: "المقارنة بين التفكيكية والحداثة"
      }
    ]
  },
    {
    title: "مدرسة شيكاغو المعمارية وتأثيرها",
    questions: [
      {
        id: 1,
        category: "التاريخ والنشأة",
        question: "أي عامل من العوامل التالية لم يُذكر كسبب رئيسي لبروز مدينة شيكاغو وتطورها السريع في القرن التاسع عشر؟",
        options: [
          "موقعها الاستراتيجي وارتباطها بنشاط السكك الحديدية",
          "حركة الملاحة النشطة في بحيرة ميتشجان",
          "كونها مركزاً لصناعة السينما والتلفزيون المبكر",
          "وجود مركز صناعي كبير للصناعات الاستخراجية والتحويلية"
        ],
        correctAnswer: 2,
        explanation: "لم يُذكر تطور صناعة السينما والتلفزيون كعامل في بروز شيكاغو المبكر. العوامل الرئيسية كانت موقعها، وحركة الملاحة، ومركزها التجاري والصناعي.",
        topic: "أسباب تطور شيكاغو كحاضرة معمارية"
      },
      {
        id: 2,
        category: "التاريخ والنشأة",
        question: "ما هو الحدث الكارثي الذي يُعتبر نقطة تحول وأساساً لظهور مدرسة شيكاغو المعمارية؟",
        options: [
          "الانهيار الاقتصادي الكبير عام 1873",
          "الحريق الكبير لمدينة شيكاغو عام 1871",
          "تغيير خطة تخطيط المدينة عام 1880",
          "اكتشاف تقنيات بناء جديدة عام 1865"
        ],
        correctAnswer: 1,
        explanation: "الحريق الكبير عام 1871 دمّر حوالي 17000 مبنى، مما خلق ضرورة ملحّة لإعادة الإعمار على نطاق واسع، وأتاح فرصة لتطبيق أفكار وتقنيات بناء جديدة.",
        topic: "أثر الحريق الكبير على العمارة"
      },
      {
        id: 3,
        category: "المبادئ والأفكار",
        question: "ما هي الفلسفة التصميمية الرئيسية التي نادت بها مدرسة شيكاغو، كما تجسدت في مقولة وليام هولابيرد؟",
        options: [
          "المباني الفاخرة هي مباني المستقبل",
          "المباني الجيدة هي المباني الرخيصة",
          "التاريخ هو مصدر الإلهام الوحيد",
          "الزخرفة تعادل الجوهر المعماري"
        ],
        correctAnswer: 1,
        explanation: "عكست مقولة \"المباني الجيدة هي المباني الرخيصة\" التركيز على الكفاءة والوظيفة والاقتصاد، وهي من سمات الفكر العملي لمدرسة شيكاغو.",
        topic: "الفلسفة الوظيفية والاقتصادية للمدرسة"
      },
      {
        id: 4,
        category: "المبادئ والأفكار",
        question: "أي من المبادئ التالية لا يعتبر من المبادئ الأساسية التي اعتمدت عليها مدرسة شيكاغو في أفكارها؟",
        options: [
          "الاستخدام المبسط للأشكال والابتعاد عن الطرز التاريخية",
          "التركيز على تصميم المباني الدينية ككنائس ومساجد",
          "أن يعبر الإنشاء عن نفسه بنفسه بوضوح",
          "اعتماد الأسلوب المنطقي العلمي في التصميم"
        ],
        correctAnswer: 1,
        explanation: "ركزت المدرسة بشكل أساسي على المباني التجارية والوظيفية (المكاتب، المتاجر، المخازن)، ولم يُذكر تركيزها على المباني الدينية كسمة أساسية.",
        topic: "المبادئ التصميمية لمدرسة شيكاغو"
      },
      {
        id: 5,
        category: "رواد المدرسة",
        question: "من هو المعماري الذي يُعتبره العديد من المختصين \"الأب الحقيقي لمدرسة شيكاغو\"، رغم طابعه الشخصي الخاص؟",
        options: [
          "لويس سوليفان",
          "دانيال بورنهام",
          "وليم لي بارون جيني",
          "جون ويلبورن روت"
        ],
        correctAnswer: 2,
        explanation: "يُعتبر وليم لي بارون جيني (William Le Baron Jenney) الأب الحقيقي للمدرسة، خاصة بتصميمه مبنى تأمين المنزل (Home Insurance Building) الذي استخدم الهيكل الفولاذي بالكامل.",
        topic: "رواد الجيل الأول لمدرسة شيكاغو"
      },
      {
        id: 6,
        category: "رواد المدرسة",
        question: "أي من المعماريين التاليين ينتمي إلى الجيل الثاني من رواد مدرسة شيكاغو، وكان صاحب مقولة \"إن المشكلة تكمن في حقيقتها\"؟",
        options: [
          "وليم هولابيرد",
          "مارتين روش",
          "لويس سوليفان",
          "إيسلوم بولينغتون"
        ],
        correctAnswer: 2,
        explanation: "لويس سوليفان (Louis Sullivan) من أهم رواد الجيل الثاني، وعمّق الفهم التطبيقي لناطحات السحاب، وهو صاحب المقولة المذكورة والعديد من المقالات المؤثرة.",
        topic: "رواد الجيل الثاني وأفكارهم"
      },
      {
        id: 7,
        category: "رواد المدرسة",
        question: "أي من المباني التالية يُنسب تصميمه إلى لويس سوليفان، وتميز باستخدام إبداعي للخطوط الأفقية وشريط النوافذ؟",
        options: [
          "مبنى محطة القطارات في شيكاغو (1903-1904)",
          "مبنى كارسون بيري سكوت (1899-1906)",
          "برج الماء القديم (1867-1869)",
          "مبنى ريلانس (1894)"
        ],
        correctAnswer: 1,
        explanation: "مبنى كارسون بيري سكوت (Carson Pirie Scott) من تصاميم سوليفان البارزة، وتميز بواجهته ذات الشرائط الأفقية والنوافذ الواسعة، مما يعكس فلسفته.",
        topic: "أعمال لويس سوليفان البارزة"
      },
      {
        id: 8,
        category: "التقنيات والمواد",
        question: "ما هي المادة الإنشائية الجديدة التي أدخلها وليم لي بارون جيني بشكل كامل في بناء مبنى تأمين المنزل (1884-1885)، مما أحدث ثورة؟",
        options: [
          "الخرسانة المسلحة فقط",
          "الزجاج المقوى هيكلياً",
          "الهيكل الحديدي (الفولاذ) بالكامل",
          "القوالب الخشبية المسلحة"
        ],
        correctAnswer: 2,
        explanation: "يُعد مبنى تأمين المنزل (Home Insurance Building) من أوائل المباني التي استخدمت الهيكل الحديدي (الفولاذي) الداعم بالكامل، مما سمح بزيادة الارتفاع وإدخال نوافذ أكبر.",
        topic: "تطور تقنيات الهيكل الإنشائي"
      },
      {
        id: 9,
        category: "التقنيات والمواد",
        question: "إلى جانب الهياكل الحديدية، أي عامل تقني آخر ساهم بشكل حاسم في ظهور ناطحات السحاب في شيكاغو؟",
        options: [
          "اكتشاف نظام التدفئة المركزية",
          "انتشار استخدام المصاعد الكهربائية",
          "تطور أنظمة الإضاءة الصناعية",
          "اختراع أنظمة تكييف الهواء"
        ],
        correctAnswer: 1,
        explanation: "ساهم انتشار المصاعد الكهربائية عملياً، جنباً إلى جنب مع الهياكل الحديدية، في جعل الارتفاعات العالية (ناطحات السحاب) قابلة للاستخدام والوصول للطوابق العليا.",
        topic: "العوامل التقنية الداعمة للبناء العالي"
      },
      {
        id: 10,
        category: "الخصائص المعمارية",
        question: "كيف اتسمت الواجهات في عمارة مدرسة شيكاغو، خاصة بالمقارنة مع الفترات السابقة؟",
        options: [
          "أصبحت أكثر انغلاقاً وبها فتحات صغيرة",
          "تخلت عن الزخرفة المفرطة وركزت على النوافذ الكبيرة",
          "اعتمدت على إحياء الزخارف القوطية المعقدة",
          "استخدمت الرخام المنحوت بوفرة في الزينة"
        ],
        correctAnswer: 1,
        explanation: "اتجهت المدرسة نحو البساطة والتخلص من الزخارف غير المنطقية، واستغلت الهياكل الحديدية لعمل واجهات بها مساحات زجاجية (نوافذ) كبيرة، تعبر عن البناء الداخلي.",
        topic: "تطور تصميم الواجهات المعمارية"
      },
      {
        id: 11,
        category: "الخصائص المعمارية",
        question: "ما هو النمط أو الطراز الذي броزت فيه تصميمات مدرسة شيكاغو بشكل رئيسي، حتى أنه أطلق عليه أحياناً \"الطراز التجاري\"؟",
        options: [
          "تصميم القصور والمساكن الفردية الفاخرة",
          "تصميم المتاحف والمكتبات العامة",
          "تصميم المباني التجارية والمكاتب والمخازن",
          "تصميم المستشفيات والمؤسسات التعليمية"
        ],
        correctAnswer: 2,
        explanation: "تميزت المدرسة بالتركيز الشديد على تصميم المباني التجارية والوظيفية مثل مكاتب الشركات والمتاجر والمخازن، مما عكس روح العصر الصناعي والاقتصادي الجديد.",
        topic: "طبيعة مشاريع مدرسة شيكاغو"
      },
      {
        id: 12,
        category: "التأثير والانتشار",
        question: "بعد نجاحها في أمريكا، أي مجلة معمارية أوروبية تم ذكرها كداعمة للاتجاهات الجديدة المشابهة لفكر مدرسة شيكاغو؟",
        options: [
          "مجلة \"العمارة الحديثة\" في لندن",
          "مجلة \"الشباب\" (Die Jugend) في ميونخ",
          "مجلة \"البانتيون\" في باريس",
          "مجلة \"البناء\" في روما"
        ],
        correctAnswer: 1,
        explanation: "ظهرت مجلة \"الشباب\" (Die Jugend) في ميونخ الألمانية كواحدة من المجلات التي دعمت التيارات الجديدة في العمارة والفن، والتي تأثرت بروح الحداثة والتجديد.",
        topic: "تأثير مدرسة شيكاغو على أوروبا"
      },
      {
        id: 13,
        category: "التأثير والانتشار",
        question: "ما الذي ساعد على تقبل الطراز الجديد وانتشاره اجتماعياً، وفقاً للنص؟",
        options: [
          "انخفاض تكلفة الحرف اليدوية التقليدية",
          "مسؤولية اجتماعية نشأت عن ركود سوق الحرف البدوية المكلفة",
          "تغير الأذواق الفنية للنخبة الأرستقراطية فقط",
          "صدور قوانين حكومية تلزم بهذا النمط"
        ],
        correctAnswer: 1,
        explanation: "أدت الصناعة المتوسعة إلى ركود سوق الحرف البدوية باهظة الثمن، مما خلق مسؤولية اجتماعية ودعماً لنمط بناء جديد أكثر كفاءة وملاءمة للعصر الصناعي.",
        topic: "العوامل الاجتماعية لانتشار الطراز"
      },
      {
        id: 14,
        category: "معلومات عامة",
        question: "بالإضافة إلى شيكاغو، في أي مدينة أمريكية أخرى صمم لويس سوليفان ناطحة سحاب بارزة هي مبنى \"غارنتي\" (1894-1895)؟",
        options: [
          "سان فرانسيسكو",
          "بوسطن",
          "نيويورك",
          "سانت لويس"
        ],
        correctAnswer: 2,
        explanation: "صمم لويس سوليفان مبنى غارنتي (Guaranty Building) في مدينة نيويورك، بالإضافة إلى مبنى وينرايت (Wainwright) في سانت لويس، مما يدل على انتشار أفكاره.",
        topic: "انتشار أعمال رواد المدرسة خارج شيكاغو"
      },
      {
        id: 15,
        category: "معلومات عامة",
        question: "ما هو المبنى الذي صممه غوستاف إيفل عام 1884، والمذكور كنموذج للاستخدام التعبيري للفولاذ، رغم كونه خارج أمريكا؟",
        options: [
          "مبنى غاليري المعدات (Gallery of Machines)",
          "قطرة جاربيت (Garabit Viaduct)",
          "محطة قطارات بودابست",
          "جسر تاور بريدج"
        ],
        correctAnswer: 1,
        explanation: "قطرة جاربيت (Garabit Viaduct) هو جسر سكة حديدية صممه غوستاف إيفل في فرنسا عام 1884، وتميز باستخدام الفولاذ وتصميمه الانسيابي التعبيري.",
        topic: "تأثير تقنيات الفولاذ عالمياً"
      },
      {
        id: 16,
        category: "معلومات عامة",
        question: "ما هو الهدف الأساسي الذي سعت إليه موجة البناء العالي الفولاذي في شيكاغو، وفقاً للنص؟",
        options: [
          "تحطيم الأرقام القياسية العالمية في الارتفاع فقط",
          "تأصيل هذا الطراز الجديد وجعله سمة للمدينة",
          "منافسة التصاميم الكلاسيكية في التكلفة",
          "إعادة إنشاء الصورة التاريخية للمدينة قبل الحريق"
        ],
        correctAnswer: 1,
        explanation: "كان الهدف تأصيل الطراز الجديد القائم على الفولاذ والوظيفة وجعله السمة المميزة لشيكاغو، مما يعكس هويتها كمدينة حديثة وصناعية رائدة.",
        topic: "الهوية المعمارية لمدينة شيكاغو"
      }
    ]
  }
];

    let state = {
            screen: 'selection', // 'selection', 'quiz', 'results'
            selectedExam: null,
            selectedQuestions: [], // shuffled questions for the current exam
            initialQuestionCount: 0, // original total before repeats
            currentQuestion: 0,
            selectedAnswer: null,
            showExplanation: false,
            score: 0,
            quizCompleted: false,
            answers: [], // records of initial-phase answers (used for scoring/stats)
            repeatQueue: [], // questions to repeat at the end
            inRepeatPhase: false,
            repeatAnswers: [] // records of repeat-phase attempts (do not affect score)
        };

        // Helper Functions

        // Fisher-Yates shuffle
        function shuffleArray(arr) {
            const a = arr.slice();
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }
        
        // Shuffle options for a single question and adjust correctAnswer index
        function shuffleQuestionOptions(question) {
            const opts = question.options.map((opt, idx) => ({ opt, idx }));
            const shuffled = shuffleArray(opts);
            const newOptions = shuffled.map(s => s.opt);
            const newCorrect = shuffled.findIndex(s => s.idx === question.correctAnswer);
            // Return a shallow copy of question with shuffled options and adjusted correctAnswer
            return Object.assign({}, question, { options: newOptions, correctAnswer: newCorrect });
        }
        function selectExam(index) {
            state.selectedExam = index;
            // prepare a shuffled copy of questions for the exam and shuffle each question's options
            const questions = examSets[index].questions || [];
            state.initialQuestionCount = questions.length;
            state.selectedQuestions = shuffleArray(questions.slice()).map(q => shuffleQuestionOptions(q));
            state.currentQuestion = 0;
            state.selectedAnswer = null;
            state.showExplanation = false;
            state.score = 0;
            state.quizCompleted = false;
            state.answers = [];
            state.repeatQueue = [];
            state.inRepeatPhase = false;
            state.repeatAnswers = [];
            state.screen = 'quiz';
            render();
        }

        function getCurrentQuestions() {
            if (state.selectedExam === null) return [];
            return state.selectedQuestions || examSets[state.selectedExam].questions || [];
        }

        function handleAnswerSelect(answerIndex) {
            if (state.selectedAnswer !== null) return;

            const questions = getCurrentQuestions();
            const question = questions[state.currentQuestion];
            state.selectedAnswer = answerIndex;
            state.showExplanation = true;

            const isCorrect = answerIndex === question.correctAnswer;

            if (!state.inRepeatPhase) {
                // Main phase: correct answers increment score and are recorded.
                if (isCorrect) {
                    state.score++;
                } else {
                    // schedule for repeat at the end (avoid duplicates)
                    if (!state.repeatQueue.some(q => q.id === question.id)) {
                        state.repeatQueue.push(question);
                    }
                }

                state.answers.push({
                    questionId: question.id,
                    correct: isCorrect,
                    category: question.category
                });
            } else {
                // Repeat phase: attempts here do NOT affect main score or main answers/stats
                state.repeatAnswers.push({
                    questionId: question.id,
                    correct: isCorrect
                });
            }

            render();
        }

        function handleNext() {
            const questions = getCurrentQuestions();
            if (state.currentQuestion < questions.length - 1) {
                state.currentQuestion++;
                state.selectedAnswer = null;
                state.showExplanation = false;
            } else {
                // End of current phase
                if (!state.inRepeatPhase && state.repeatQueue.length > 0) {
                    // start repeat phase with the queued wrong questions (maintain their order as collected)
                    state.selectedQuestions = state.repeatQueue.slice();
                    state.repeatQueue = [];
                    state.inRepeatPhase = true;
                    state.currentQuestion = 0;
                    state.selectedAnswer = null;
                    state.showExplanation = false;
                } else {
                    // fully finished (either no repeats or repeats finished)
                    state.quizCompleted = true;
                }
            }
            render();
        }

        function handleRestart() {
            // restart current exam from scratch (reshuffle)
            if (state.selectedExam !== null) {
                const questions = examSets[state.selectedExam].questions || [];
                state.initialQuestionCount = questions.length;
                state.selectedQuestions = shuffleArray(questions.slice()).map(q => shuffleQuestionOptions(q));
            }
            state.currentQuestion = 0;
            state.selectedAnswer = null;
            state.showExplanation = false;
            state.score = 0;
            state.quizCompleted = false;
            state.answers = [];
            state.repeatQueue = [];
            state.inRepeatPhase = false;
            state.repeatAnswers = [];
            render();
        }

        function backToMenu() {
            state = {
                screen: 'selection',
                selectedExam: null,
                selectedQuestions: [],
                initialQuestionCount: 0,
                currentQuestion: 0,
                selectedAnswer: null,
                showExplanation: false,
                score: 0,
                quizCompleted: false,
                answers: [],
                repeatQueue: [],
                inRepeatPhase: false,
                repeatAnswers: []
            };
            render();
        }

        // SVG Icons
        const icons = {
            checkCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon" style="color: #10b981;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',
            xCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon" style="color: #ef4444;"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',
            award: '<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="trophy-icon"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>',
            bookOpen: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>'
        };

        // Render Functions
        function renderExamSelection() {
            if (examSets.length === 0 || examSets.every(set => set.questions.length === 0)) {
                return `
                    <div class="exam-selection">
                        <h1>مرحباً بك في كويز الإعراب</h1>
                        <p style="color: #ef4444; margin-top: 2rem;">الرجاء إضافة الأسئلة في ملف HTML</p>
                        <p style="color: #6b7280; font-size: 1rem;">ابحث عن "PASTE YOUR QUESTIONS ARRAYS HERE" في الكود</p>
                    </div>
                `;
            }

            const examCards = examSets.map((examSet, index) => {
                if (examSet.questions.length === 0) return '';
                return `
                    <div class="exam-card" onclick="selectExam(${index})">
                        <h3>${examSet.title}</h3>
                        <p class="question-count">${examSet.questions.length} سؤال</p>
                    </div>
                `;
            }).join('');

            return `
                <div class="exam-selection">
                    <h1>مرحباً بك في امتحانات الفاينال</h1>
                    <p>اختر الامتحان الذي تريد البدء به</p>
                    <div class="exam-options">
                        ${examCards}
                    </div>
                </div>
            `;
        }

        function renderResults() {
            // Use the initial question count for score/percentage calculation
            const total = state.initialQuestionCount || (state.selectedExam !== null ? (examSets[state.selectedExam].questions || []).length : 0);
            const percentage = total > 0 ? Math.round((state.score / total) * 100) : 0;
            let message = "";
            let colorClass = "";

            if (percentage >= 90) {
                message = "ممتاز جداً! أنت متمكن ومستعد تماماً للامتحان";
                colorClass = "color: #16a34a;";
            } else if (percentage >= 80) {
                message = "ممتاز! مستواك جيد جداً، راجع الأخطاء فقط";
                colorClass = "color: #22c55e;";
            } else if (percentage >= 70) {
                message = "جيد جداً! تحتاج لمراجعة بعض النقاط";
                colorClass = "color: #2563eb;";
            } else if (percentage >= 60) {
                message = "جيد! ركز على المواضيع التي أخطأت فيها";
                colorClass = "color: #ca8a04;";
            } else {
                message = "تحتاج لمزيد من المراجعة والتدريب";
                colorClass = "color: #ea580c;";
            }

            // Calculate category stats
            const categoryStats = {};
            state.answers.forEach(answer => {
                if (!categoryStats[answer.category]) {
                    categoryStats[answer.category] = { correct: 0, total: 0 };
                }
                categoryStats[answer.category].total++;
                if (answer.correct) categoryStats[answer.category].correct++;
            });

            const statsHTML = Object.entries(categoryStats).map(([cat, stats]) => {
                const pct = Math.round((stats.correct / stats.total) * 100);
                return `
                    <div class="stat-item">
                        <div class="stat-row">
                            <div class="stat-category">${cat}</div>
                            <div class="stat-score">${stats.correct}/${stats.total} (${pct}%)</div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="results-container">
                    ${icons.award}
                    <h2 class="results-title">انتهى الكويز!</h2>
                    <div class="final-score">${state.score}/${total}</div>
                    <div class="percentage">النسبة: ${percentage}%</div>
                    <p class="results-message" style="${colorClass}">${message}</p>

                    <div class="category-stats">
                        <h3 class="stats-title">
                            ${icons.bookOpen}
                            أداؤك حسب المواضيع:
                        </h3>
                        ${statsHTML.length > 0 ? statsHTML : '<p style="text-align: right; color: #6b7280;">لم يتم تسجيل إجابات.</p>'}

                        <div class="action-buttons">
                            <button class="btn-primary" onclick="handleRestart()">أعد المحاولة</button>
                            <button class="btn-secondary" onclick="backToMenu()">العودة للقائمة الرئيسية</button>
                        </div>

                        <div class="final-stats">
                            <p>النقاط النهائية: <span class="final-score-value">${state.score}</span></p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderQuestion() {
            const questions = getCurrentQuestions();
            const question = questions[state.currentQuestion];
            const examTitle = examSets[state.selectedExam].title;
            
            // Determine label for question number (show repeat-phase clearly)
            const mainTotal = state.initialQuestionCount || questions.length;
            const questionNumberText = state.inRepeatPhase ? `إعادة السؤال ${state.currentQuestion + 1} من ${questions.length}` : `السؤال ${state.currentQuestion + 1} من ${mainTotal}`;

            const optionsHTML = question.options.map((option, index) => {
                let btnClass = "option-btn";
                let iconHTML = "";

                if (state.selectedAnswer === null) {
                    // No answer selected yet
                } else if (index === question.correctAnswer) {
                    btnClass += " correct";
                    iconHTML = icons.checkCircle;
                } else if (index === state.selectedAnswer) {
                    btnClass += " incorrect";
                    iconHTML = icons.xCircle;
                } else {
                    btnClass += " neutral";
                }

                return `
                    <button 
                        class="${btnClass}" 
                        onclick="handleAnswerSelect(${index})"
                        ${state.selectedAnswer !== null ? 'disabled' : ''}
                    >
                        <span style="text-align: right; line-height: 1.75;">${option}</span>
                        ${iconHTML}
                    </button>
                `;
            }).join('');

            const explanationHTML = state.showExplanation ? `
                <div class="explanation-box ${state.selectedAnswer === question.correctAnswer ? 'correct' : 'incorrect'}">
                    <p class="explanation-title">
                        ${state.selectedAnswer === question.correctAnswer ? '✅ إجابة صحيحة! ممتاز' : '❌ إجابة خاطئة'}
                    </p>
                    <div class="explanation-content">
                        <p class="explanation-text">
                            <strong>الشرح التفصيلي:</strong><br>
                            ${question.explanation}
                        </p>
                    </div>
                    <div class="topic-info">
                        ${icons.bookOpen}
                        <p><strong>راجع:</strong> ${question.topic}</p>
                    </div>
                </div>
                <button class="next-btn" onclick="handleNext()">
                    ${state.currentQuestion < questions.length - 1 ? 'السؤال التالي ←' : 'إنهاء الكويز وعرض النتائج 🎉'}
                </button>
            ` : '';

            return `
                <div class="header">
                    <h1>${examTitle}</h1>
                    <div class="score-info">
                        <div class="question-number">${questionNumberText}</div>
                        <div class="score">النقاط: ${state.score}</div>
                    </div>
                </div>

                <div class="question-container">
                    <h2 class="category">${question.category}</h2>
                    <p class="question">${question.question}</p>

                    <div class="options">
                        ${optionsHTML}
                    </div>

                    ${explanationHTML}

                    <div class="current-score">
                        <p>النتيجة الحالية: <span class="score-value">${state.score}</span> من ${state.currentQuestion + (state.selectedAnswer !== null ? 1 : 0)}</p>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button class="restart-btn" onclick="handleRestart()">إعادة البدء</button>
                    <button class="back-to-menu-btn" onclick="backToMenu()">القائمة الرئيسية</button>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.screen === 'selection') {
                app.innerHTML = renderExamSelection();
            } else if (state.quizCompleted) {
                app.innerHTML = renderResults();
            } else {
                app.innerHTML = renderQuestion();
            }
        }

        // Initial render
        render();
    </script>
</body>
</html>